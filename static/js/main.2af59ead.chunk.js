(this["webpackJsonpsortly-de"]=this["webpackJsonpsortly-de"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"static/media/logo.3de73253.png"},function(e,t,a){},,,,,,,,function(e,t,a){e.exports=a.p+"static/media/population.b123bcc2.jpg"},function(e,t,a){e.exports=a.p+"static/media/area.1a41ffef.jpg"},,,,,function(e,t,a){e.exports=a(65)},,,,,,,,,,function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(23),l=a.n(o),c=a(10),i=a(69),s=a(30),u=a(3),m=a(14),d=a.n(m),p=(a(42),a(17)),g=a.n(p),b=a(15),y=a(25),v=a(6),h=a(4);const f=Object(y.a)({apiKey:"AIzaSyAOZkZ8FGkHv6J4xD-yckuKOasuO4zEF2c",authDomain:"sortly-1b701.firebaseapp.com",projectId:"sortly-1b701",storageBucket:"sortly-1b701.firebasestorage.app",messagingSenderId:"37869262835",appId:"1:37869262835:web:9d463c1b217727d88e6486",databaseURL:"https://sortly-1b701-default-rtdb.europe-west1.firebasedatabase.app"}),E=Object(b.b)(f),w=Object(v.f)(f),O=Object(h.b)(f);const j=Object(n.createContext)();function C(){return Object(n.useContext)(j)}function N(e){let{children:t}=e;const[a,o]=Object(n.useState)(null),[l,c]=Object(n.useState)(!0);Object(n.useEffect)(()=>Object(b.c)(E,e=>{o(e),c(!1)}),[]);const i={currentUser:a,signup:function(e,t){return Object(b.a)(E,e,t)},login:function(e,t){return Object(b.d)(E,e,t)},logout:function(){return Object(b.e)(E)}};return r.a.createElement(j.Provider,{value:i},!l&&t)}const S={getAvatarOptions:()=>[{id:"default",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=default",name:"Default"},{id:"happy",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=happy",name:"Happy"},{id:"cool",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=cool",name:"Cool"},{id:"smart",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=smart",name:"Smart"},{id:"friendly",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=friendly",name:"Friendly"},{id:"adventurous",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=adventurous",name:"Adventurous"},{id:"creative",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=creative",name:"Creative"},{id:"mysterious",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=mysterious",name:"Mysterious"}]},k={async getUserProfile(e){try{const t=await Object(v.d)(Object(v.c)(w,"users",e));if(t.exists())return t.data();const a={nickname:"",country:"",avatarUrl:S.getAvatarOptions()[0].url,createdAt:new Date};return await this.updateUserProfile(e,a),a}catch(t){throw console.error("Error getting user profile:",t),t}},async updateUserProfile(e,t){try{const a=Object(v.c)(w,"users",e);await Object(v.k)(a,{...t,updatedAt:new Date},{merge:!0})}catch(a){throw console.error("Error updating user profile:",a),a}},async updateProfileField(e,t,a){try{const n=Object(v.c)(w,"users",e);await Object(v.l)(n,{[t]:a,updatedAt:new Date})}catch(n){throw console.error("Error updating profile field:",n),n}}};a(47);function P(){const{currentUser:e,login:t,signup:a,logout:o}=C(),[l,c]=Object(n.useState)(""),[i,s]=Object(n.useState)(""),[m,d]=Object(n.useState)(""),[p,g]=Object(n.useState)(!1),[b,y]=Object(n.useState)(!1),[v,h]=Object(n.useState)(null),f=Object(u.o)();return Object(n.useEffect)(()=>{(async()=>{if(e)try{const t=await k.getUserProfile(e.uid);h(t)}catch(m){console.error("Error loading user profile:",m)}})()},[e]),e?r.a.createElement("div",{className:"login-button"},r.a.createElement("div",{className:"user-profile-button",onClick:()=>f("/profile")},r.a.createElement("img",{src:(null===v||void 0===v?void 0:v.avatarUrl)||S.getAvatarOptions()[0].url,alt:"Profile",className:"header-avatar"}),r.a.createElement("span",{className:"user-name"},(null===v||void 0===v?void 0:v.nickname)||e.email)),r.a.createElement("button",{onClick:async function(){try{d(""),g(!0),await o(),f("/")}catch(m){d("Failed to log out: "+m.message)}g(!1)},disabled:p,className:"logout-button"},"Log Out")):r.a.createElement("div",{className:"login-button"},b?r.a.createElement("div",{className:"login-form"},r.a.createElement("input",{type:"email",value:l,onChange:e=>c(e.target.value),placeholder:"Email",required:!0}),r.a.createElement("input",{type:"password",value:i,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),r.a.createElement("div",{className:"login-buttons"},r.a.createElement("button",{onClick:async function(e){e.preventDefault();try{d(""),g(!0),await t(l,i),y(!1),f("/profile")}catch(m){d("Failed to log in: "+m.message)}g(!1)},disabled:p},"Login"),r.a.createElement("button",{onClick:async function(e){e.preventDefault();try{d(""),g(!0),await a(l,i),y(!1),f("/profile")}catch(m){d("Failed to create an account: "+m.message)}g(!1)},disabled:p},"Sign Up"),r.a.createElement("button",{onClick:()=>y(!1)},"Cancel")),m&&r.a.createElement("p",{style:{color:"red"}},m)):r.a.createElement("button",{onClick:()=>y(!0)},"Login / Sign Up"))}var A=function(){const[e,t]=Object(n.useState)(!1),a=()=>{t(!1)};return r.a.createElement("header",{className:"header"},r.a.createElement("div",{className:"header-container"},r.a.createElement(c.b,{to:"/",className:"header-logo",onClick:a},r.a.createElement("img",{src:g.a,alt:"Sortly Logo",className:"logo-image"}),r.a.createElement("span",{className:"site-name"},"Sortly - The Sorting Game")),r.a.createElement("button",{className:"menu-button",onClick:()=>{t(!e)}},"\u2630"),r.a.createElement("nav",{className:"header-nav "+(e?"active":"")},r.a.createElement(c.b,{to:"/",className:"nav-link",onClick:a},"Home"),r.a.createElement(c.b,{to:"/game/population",className:"nav-link",onClick:a},"Population"),r.a.createElement(c.b,{to:"/game/area",className:"nav-link",onClick:a},"Area"),r.a.createElement(c.b,{to:"/leaderboard",className:"nav-link",onClick:a},"Leaderboard"),r.a.createElement("div",{className:"nav-login"},r.a.createElement(P,null)))))};a(48);var U=function(){return r.a.createElement("footer",{className:"footer"},r.a.createElement("div",{className:"footer-container"},r.a.createElement("img",{src:g.a,alt:"Sortly Logo",className:"footer-logo"}),r.a.createElement("p",null,"\xa9 ",(new Date).getFullYear()," Sortly. All rights reserved.")))},G=a(26),x=a.n(G),D=a(27),I=a.n(D);a(49);var R=function(){const e=Object(u.o)();return r.a.createElement("div",{className:"homepage"},r.a.createElement("div",{className:"section population-section",style:{backgroundImage:`url(${x.a})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},r.a.createElement("div",{className:"overlay"},r.a.createElement("h2",null,"Sort by Population"),r.a.createElement("div",{className:"population-modes mode-buttons"},r.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Population Classic",label:"Population Classic"}),e("/game/population")}},"Classic Mode"),r.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Population Cooperation",label:"Population Cooperation"}),e("/game/population/cooperation")}},"Cooperation Mode"),r.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Population Battle Royale",label:"Population Battle Royale"}),e("/game/population/battleroyale")}},"Battle Royale Mode")))),r.a.createElement("div",{className:"section area-section",style:{backgroundImage:`url(${I.a})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},r.a.createElement("div",{className:"overlay"},r.a.createElement("h2",null,"Sort by Area"),r.a.createElement("div",{className:"area-modes mode-buttons"},r.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Area Classic",label:"Area Classic"}),e("/game/area")}},"Classic Mode")))))};a(50);var L=function(e){let{country:t,isClickable:a,highlight:o,mode:l,onClick:c,customClassName:i}=e;const[s,u]=Object(n.useState)(!1),m=o?"highlighted-"+o:"";return r.a.createElement("div",{className:`country-card ${s?"flipped":""} ${a?"clickable":""} ${m} ${i||""}`,onClick:()=>{c?a&&c():a&&u(!s)}},r.a.createElement("div",{className:"card-inner"},r.a.createElement("div",{className:"card-face card-front "+m},r.a.createElement("img",{src:t.flagUrl,alt:"Flag of "+t.name,className:"country-flag"}),r.a.createElement("div",{className:"country-info"},r.a.createElement("h3",{className:"country-name"},t.name))),r.a.createElement("div",{className:"card-face card-back "+m},r.a.createElement("div",{className:"country-info"},r.a.createElement("h3",{className:"country-name"},t.name),r.a.createElement("p",{className:"country-detail"},{population:"Population: "+t.population.toLocaleString(),area:`Area: ${t.area.toLocaleString()} km\xb2`}[l]||"")))))};a(18);const _=async()=>{try{const e=await fetch("https://restcountries.com/v3.1/all");if(!e.ok)throw new Error("HTTP error! status: "+e.status);const t=await e.json();if(!Array.isArray(t))throw new Error("Invalid data format received from API");const a=t.filter(e=>{var t,a;return e.unMember&&(null===(t=e.name)||void 0===t?void 0:t.common)&&(null===(a=e.flags)||void 0===a?void 0:a.svg)&&"number"===typeof e.population&&"number"===typeof e.area});return a.map((e,t)=>({id:t+1,name:e.name.common,flagUrl:e.flags.svg,population:e.population,area:e.area}))}catch(e){throw console.error("Error fetching countries:",e),new Error("Failed to fetch countries data. Please try again later.")}},F={async initializeGameState(e,t){let a;try{if(a=await _(),!a||a.length<11)throw new Error("Not enough valid countries fetched to start cooperation mode.")}catch(i){throw console.error("Failed to fetch countries for initialization:",i),new Error("Could not fetch country data to start the game.")}const n=((e,t)=>{t>e.length&&(console.warn("Requested more elements than available"),t=e.length);return[...e].sort(()=>.5-Math.random()).slice(0,t)})(a,11),r=n[0],o=n.slice(1),l=Object(h.e)(O,"gameStates/"+e),c={lobbyId:e,currentPlayer:t[0].id,players:t,mode:"choosing",sortedCountries:[r],remainingCountries:o,currentCountry:null,score:1,status:"playing",createdAt:Date.now(),lastUpdated:Date.now()};await Object(h.g)(l,c),console.log("Initialized game state for lobby",e,c)},subscribeToGameState(e,t){const a=Object(h.e)(O,"gameStates/"+e),n=Object(h.d)(a,e=>{const a=e.val();t(a)},e=>{console.error("Error subscribing to game state:",e),t(null)});return()=>Object(h.c)(a,"value",n)},async updateGameState(e,t){const a=Object(h.e)(O,"gameStates/"+e);await Object(h.h)(a,{...t,lastUpdated:Date.now()})},async chooseCard(e,t,a){const n=Object(h.e)(O,"gameStates/"+e),r=(await Object(h.a)(n)).val();if(!r||"playing"!==r.status)throw new Error("Game is not active or not found");if("choosing"!==r.mode)throw new Error("Not in choosing mode");if(r.currentPlayer!==t)throw new Error("Not your turn to choose");if(!r.remainingCountries||!r.remainingCountries.some(e=>e.id===a.id))throw console.error("Chosen country ID not found in remaining:",null===a||void 0===a?void 0:a.id,r.remainingCountries),new Error("Chosen country is not valid or not in the remaining inventory");await Object(h.h)(n,{currentCountry:a,mode:"placing",lastUpdated:Date.now()})},async placeCard(e,t,a){const n=Object(h.e)(O,"gameStates/"+e),r=(await Object(h.a)(n)).val();if(!r||"playing"!==r.status)throw new Error("Game is not active or not found");if("placing"!==r.mode)throw new Error("Not in placing mode");if(r.currentPlayer!==t)throw new Error("Not your turn to place");if(!r.currentCountry)throw new Error("No country currently chosen for placement");if("number"!==typeof a||a<0||a>r.sortedCountries.length)throw console.error("Invalid placement index received:",a,"Current sorted length:",r.sortedCountries.length),new Error("Invalid placement index");const o=[...r.sortedCountries];o.splice(a,0,r.currentCountry);if((e=>{if(!Array.isArray(e))return console.error("isCorrect received non-array:",e),!1;for(let t=0;t<e.length-1;t++)if(!e[t]||!e[t+1]||"undefined"===typeof e[t].population||"undefined"===typeof e[t+1].population||e[t].population>e[t+1].population)return console.warn(`Incorrect order found at index ${t}:`,e[t],e[t+1]),!1;return!0})(o)){var l;const e=r.currentCountry.id;let a=r.remainingCountries||[];a=a.filter(t=>t.id!==e);let c=null===(l=r.players[0])||void 0===l?void 0:l.id;if(r.players.length>1){const e=r.players.findIndex(e=>e.id===t);c=r.players[(e+1)%r.players.length].id}const i={currentPlayer:c,sortedCountries:o,remainingCountries:a,currentCountry:null,mode:"choosing",score:r.score+1,lastUpdated:Date.now()};0===a.length&&(i.status="completed",i.result="win",i.mode="finished"),await Object(h.h)(n,i)}else console.log(`Incorrect placement by ${t}. Ending game.`),await this.endGame(e)},async endGame(e){const t=Object(h.e)(O,"gameStates/"+e),a=await Object(h.a)(t);a.exists()&&"playing"===a.val().status?(await Object(h.h)(t,{status:"completed",result:"lose",mode:"finished",currentCountry:null,lastUpdated:Date.now()}),console.log("Game ended with lose state for lobby:",e)):console.log("Game already completed or does not exist, skipping endGame call for lobby:",e)},async cleanupGameState(e){const t=Object(h.e)(O,"gameStates/"+e);await Object(h.g)(t,null)}};var M=function(){var e;const{currentUser:t}=C(),[a,o]=Object(n.useState)([]),[l,c]=Object(n.useState)(null),[i,s]=Object(n.useState)([]),[m,d]=Object(n.useState)(0),[p,g]=Object(n.useState)("waiting"),[b,y]=Object(n.useState)(null),v=Object(u.o)(),h=Object(u.m)();Object(n.useEffect)(()=>{const{lobbyId:e,gameMode:t}=h.state||{};if(!e||"cooperation"!==t)return console.error("Incorrect state for Cooperation GamePage:",h.state),void v("/");const a=F.subscribeToGameState(e,t=>{if(t){if(y(t),d(void 0!==t.score?t.score:0),o(t.sortedCountries||[]),c(t.currentCountry||null),s(t.remainingCountries||[]),g(t.status||"waiting"),"completed"===t.status){let e="Game Over!",a=t.score||0;"win"===t.result?e="Congratulations! You sorted all countries correctly.":"lose"===t.result&&(e="Game Over! An incorrect move was made."),v("/gameover",{state:{score:a,message:e,gameMode:"cooperation"},replace:!0})}}else console.error("Game state not found for lobby:",e),v("/")});return()=>a()},[h.state,v,t]);const f=async e=>{if(b&&t&&l&&b.currentPlayer===t.uid&&"placing"===b.mode)try{await F.placeCard(b.lobbyId,t.uid,e)}catch(a){console.error("Error placing card:",a)}};if(!b||"waiting"===p)return r.a.createElement("div",{className:"game-page"},"Loading Game...");const E=b.currentPlayer===(null===t||void 0===t?void 0:t.uid),w=(null===(e=b.players.find(e=>e.id===b.currentPlayer))||void 0===e?void 0:e.name)||"Unknown",O="placing"===b.mode&&E&&l;return r.a.createElement("div",{className:"game-page"},r.a.createElement("h2",null,"Cooperation Mode"),r.a.createElement("p",null,"Current Turn: ",w),r.a.createElement("p",null,"Score: ",m),r.a.createElement("div",{className:"sorted-countries-container"},r.a.createElement("h3",null,"Sorted Countries:"),r.a.createElement("div",{className:"sorted-countries"},O&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>f(0),"aria-label":"Place card at the beginning"},"+"),a.map((e,t)=>r.a.createElement(r.a.Fragment,{key:"sorted-fragment-"+e.id},r.a.createElement(L,{country:e,isClickable:!1,mode:"population"}),O&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>f(t+1),"aria-label":"Place card after "+e.name},"+"))),0===a.length&&O&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>f(0),"aria-label":"Place first card"},"+"))),r.a.createElement("div",{className:"remaining-countries"},r.a.createElement("h3",null,"Remaining Countries to Sort: (",i.length,")"),r.a.createElement("div",{className:"remaining-countries-grid"},i.map(e=>{const a="placing"===b.mode&&l&&e.id===l.id;return r.a.createElement(L,{key:"remaining-"+e.id,country:e,isClickable:"choosing"===b.mode&&E,onClick:()=>"choosing"===b.mode&&E&&(async e=>{if(b&&t&&b.currentPlayer===t.uid&&"choosing"===b.mode)try{await F.chooseCard(b.lobbyId,t.uid,e)}catch(a){console.error("Error choosing card:",a)}})(e),mode:"population",customClassName:a?"selected-for-placing":""})}))),r.a.createElement("div",{className:"game-instructions"},"choosing"===b.mode&&(E?r.a.createElement("p",null,"Choose a country from the remaining countries to place next."):r.a.createElement("p",null,"Waiting for ",w," to choose a country...")),"placing"===b.mode&&(E?r.a.createElement("p",null,"Place ",null===l||void 0===l?void 0:l.name," in the correct position based on population."):r.a.createElement("p",null,"Waiting for ",w," to place ",null===l||void 0===l?void 0:l.name,"..."))))};var $=function(){const[e,t]=Object(n.useState)([]),[a,o]=Object(n.useState)([]),[l,c]=Object(n.useState)(null),[i,s]=Object(n.useState)(0),[m,d]=Object(n.useState)("loading"),[p,g]=Object(n.useState)(!0),[b,y]=Object(n.useState)(null),v=Object(u.o)();Object(n.useEffect)(()=>{(async()=>{g(!0),y(null);try{const e=(await _()).sort(()=>.5-Math.random());if(e.length>=2){const a=e[0],n=e[1];o([a]),c(n),t(e.slice(2)),s(1),d("placing")}else 1===e.length?(o([e[0]]),c(null),t([]),s(0),d("ended"),v("/gameover",{state:{score:0,message:"Only one country found, nothing to sort!",mode:"classic_population"},replace:!0})):(y("Not enough countries found to start the game."),d("ended"))}catch(e){console.error("Failed to load countries:",e),y(e.message||"Failed to load game data."),d("ended")}finally{g(!1)}})()},[v]);const h=n=>{if(!l||"placing"!==m)return;const r=l,u=[...a];u.splice(n,0,r);let p=!0;if(n>0&&(p=p&&u[n-1].population<=r.population),n<u.length-1&&(p=p&&r.population<=u[n+1].population),p)o(u),s(i+1),c(null),(()=>{if(e.length>0){const a=e[0];c(a),t(e.slice(1)),d("placing")}else d("ended"),v("/gameover",{state:{score:i,message:"Congratulations! You sorted all countries!",mode:"classic_population"},replace:!0})})();else{const e=[...a],t=r,o=n;d("ended"),v("/gameover",{state:{score:i,message:"Incorrect placement. Game Over!",mode:"classic_population",finalSortedList:e,incorrectCountry:t,attemptedIndex:o},replace:!0})}};return p?r.a.createElement("div",{className:"game-page"},"Loading Game..."):b?r.a.createElement("div",{className:"game-page"},"Error: ",b," ",r.a.createElement("button",{onClick:()=>window.location.reload()},"Retry")):"ended"!==m||p?r.a.createElement("div",{className:"game-page"},r.a.createElement("h2",null,"Classic Mode - Sort by Population (Lowest to Highest)"),r.a.createElement("p",null,"Score: ",i-1),r.a.createElement("div",{className:"sorted-countries-container"},r.a.createElement("div",{className:"sorted-countries"},l&&"placing"===m&&r.a.createElement("div",{className:"insertion-point",onClick:()=>h(0),title:`Place ${l.name} at the beginning`},"+"),a.map((e,t)=>r.a.createElement(r.a.Fragment,{key:"fragment-"+e.id},r.a.createElement(L,{country:e,isClickable:!0,mode:"population"}),l&&"placing"===m&&r.a.createElement("div",{className:"insertion-point",onClick:()=>h(t+1),title:`Place ${l.name} after ${e.name}`},"+"))))),"placing"===m&&l&&r.a.createElement("div",{className:"current-country"},r.a.createElement("h3",null,"Place this Country:"),r.a.createElement("div",{className:"current-country-wrapper",title:l.name+" - place it in the list above"},r.a.createElement(L,{country:l,isClickable:!1,mode:"population"})))):r.a.createElement("div",{className:"game-page"},"Game Over! Final Score: ",i)};const T={async initializeGameState(e,t){if(t.length<2||t.length>8)throw new Error("Battle Royale mode requires between 2 and 8 players.");let a;try{if(a=await _(),!a||a.length<26)throw new Error("Not enough valid countries fetched to start Battle Royale mode. Need 26.")}catch(s){throw console.error("Failed to fetch countries for initialization:",s),new Error("Could not fetch country data to start the game.")}const n=((e,t)=>{t>e.length&&(console.warn("Requested more elements than available"),t=e.length);return[...e].sort(()=>.5-Math.random()).slice(0,t)})(a,26),r=n[0],o=n.slice(1),l=t.map(e=>({...e,isActive:!0,score:0})),c=Object(h.e)(O,"battleRoyaleGameStates/"+e),i={lobbyId:e,gameType:"battleRoyale",currentPlayer:l[0].id,players:l,activePlayers:l.map(e=>e.id),mode:"choosing",sortedCountries:[r],remainingCountries:o,currentCountry:null,status:"playing",createdAt:Date.now(),lastUpdated:Date.now()};await Object(h.g)(c,i),console.log("Initialized Battle Royale game state for lobby",e,"at path battleRoyaleGameStates/"+e)},subscribeToGameState(e,t){const a=Object(h.e)(O,"battleRoyaleGameStates/"+e),n=Object(h.d)(a,e=>{const a=e.val();t(a)},e=>{console.error("Error subscribing to game state:",e),t(null)});return()=>Object(h.c)(a,"value",n)},async updateGameState(e,t){const a=Object(h.e)(O,"battleRoyaleGameStates/"+e);await Object(h.h)(a,{...t,lastUpdated:Date.now()})},async chooseCard(e,t,a){const n=Object(h.e)(O,"battleRoyaleGameStates/"+e),r=(await Object(h.a)(n)).val();if(!r||"playing"!==r.status)throw new Error("Game is not active or not found");if("choosing"!==r.mode)throw new Error("Not in choosing mode");if(r.currentPlayer!==t)throw new Error("Not your turn to choose");const o=r.players.find(e=>e.id===t);if(!o||!o.isActive)throw new Error("You have been eliminated from the game.");if(!r.remainingCountries||!r.remainingCountries.some(e=>e.id===a.id))throw console.error("Chosen country ID not found in remaining:",null===a||void 0===a?void 0:a.id,r.remainingCountries),new Error("Chosen country is not valid or not in the remaining inventory");await Object(h.h)(n,{currentCountry:a,mode:"placing",lastUpdated:Date.now()})},_findNextActivePlayer(e,t){const a=e.filter(e=>e.isActive);if(0===a.length)return null;const n=a.findIndex(e=>e.id===t);return-1===n||n===a.length-1?a[0].id:a[n+1].id},async placeCard(e,t,a){const n=Object(h.e)(O,"battleRoyaleGameStates/"+e);let r=(await Object(h.a)(n)).val();if(!r||"playing"!==r.status)throw new Error("Game is not active or not found");if("placing"!==r.mode)throw new Error("Not in placing mode");if(r.currentPlayer!==t)throw new Error("Not your turn to place");if(!r.currentCountry)throw new Error("No country currently chosen for placement");const o=r.players.find(e=>e.id===t);if(!o||!o.isActive)throw new Error("You have been eliminated from the game.");if("number"!==typeof a||a<0||a>r.sortedCountries.length)throw console.error("Invalid placement index received:",a,"Current sorted length:",r.sortedCountries.length),new Error("Invalid placement index");const l=[...r.sortedCountries];l.splice(a,0,r.currentCountry);let c={};const i=r.players,s=r.currentCountry.id;if((e=>{if(!Array.isArray(e))return!1;for(let t=0;t<e.length-1;t++)if(!e[t]||!e[t+1]||"undefined"===typeof e[t].population||"undefined"===typeof e[t+1].population||e[t].population>e[t+1].population)return!1;return!0})(l)){console.log(`Correct placement by ${t}.`);const e=(r.remainingCountries||[]).filter(e=>e.id!==s),a=i.findIndex(e=>e.id===t);-1!==a&&(i[a].score=(i[a].score||0)+1);c={players:i,currentPlayer:this._findNextActivePlayer(i,t),sortedCountries:l,remainingCountries:e,currentCountry:null,mode:"choosing",lastUpdated:Date.now()}}else{console.log(`Incorrect placement by ${t}. Eliminating player.`);const e=i.findIndex(e=>e.id===t);-1!==e&&(i[e].isActive=!1);const a=i.filter(e=>e.isActive),n=a.map(e=>e.id);if(a.length<=1)console.log("Battle Royale finished. Winner determined."),c={players:i,activePlayers:n,status:"completed",mode:"finished",result:1===a.length?a[0].id:"draw",winner:1===a.length?a[0]:null,currentCountry:null,lastUpdated:Date.now()};else{c={players:i,activePlayers:n,currentPlayer:this._findNextActivePlayer(i,t),currentCountry:null,remainingCountries:(r.remainingCountries||[]).filter(e=>e.id!==s),mode:"choosing",lastUpdated:Date.now()}}}await Object(h.h)(n,c)},async endGame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=Object(h.e)(O,"battleRoyaleGameStates/"+e),n=await Object(h.a)(a);if(n.exists()){const e=n.val();if("playing"===e.status){const n=e.players.find(e=>e.id===t);await Object(h.h)(a,{status:"completed",result:t||"ended",winner:n||null,mode:"finished",currentCountry:null,lastUpdated:Date.now()}),console.log("Battle Royale game ended. Winner: "+(t||"N/A"))}else console.log("Game already completed, skipping endGame call.")}else console.log("Game state not found, cannot end game for lobby:",e)},async cleanupGameState(e){const t=Object(h.e)(O,"battleRoyaleGameStates/"+e);await Object(h.g)(t,null),console.log("Cleaned up Battle Royale game state for lobby:",e)}};var B=function(){const{currentUser:e}=C(),[t,a]=Object(n.useState)([]),[o,l]=Object(n.useState)(null),[c,i]=Object(n.useState)([]),[s,m]=Object(n.useState)("waiting"),[d,p]=Object(n.useState)(null),g=Object(u.o)(),b=Object(u.m)();Object(n.useEffect)(()=>{const{lobbyId:e,gameMode:t}=b.state||{};if(!e||"battleRoyale"!==t)return console.error("No lobbyId or incorrect gameMode found in location state.",b.state),void g("/");const n=T.subscribeToGameState(e,t=>{if(t){if(p(t),a(t.sortedCountries||[]),l(t.currentCountry||null),i(t.remainingCountries||[]),m(t.status||"waiting"),"completed"===t.status){let e="Battle Royale Over!",a="N/A",n=0;t.winner?(a=t.winner.name,n=t.winner.score||0,e=a+" is the last one standing!"):"draw"===t.result&&(e="The Battle Royale ended in a draw!"),g("/gameover",{state:{score:n,message:e,winnerName:a,gameMode:"battleRoyale",finalPlayersState:t.players},replace:!0})}}else console.error("Game state not found for lobby:",e),g("/")});return()=>n()},[b.state,g]);const y=async t=>{if(!d||!e||!o)return;if(d.currentPlayer!==e.uid)return;if("placing"!==d.mode)return;const a=d.players.find(t=>t.id===e.uid);if(a&&a.isActive)try{await T.placeCard(d.lobbyId,e.uid,t)}catch(n){console.error("Error placing card:",n)}else console.log("Cannot place card, you are eliminated.")};if(!d||"waiting"===s)return r.a.createElement("div",{className:"game-page"},"Loading Battle Royale...");const v=d.players.find(t=>t.id===(null===e||void 0===e?void 0:e.uid)),h=d.currentPlayer===(null===e||void 0===e?void 0:e.uid)&&(null===v||void 0===v?void 0:v.isActive),f=null===v||void 0===v?void 0:v.isActive,E=d.players.find(e=>e.id===d.currentPlayer),w=(null===E||void 0===E?void 0:E.name)||"Unknown",O="choosing"===d.mode&&h,j="placing"===d.mode&&h&&o;return r.a.createElement("div",{className:"game-page battle-royale-page "+(f?"":"eliminated")},r.a.createElement("h2",null,"Battle Royale"),r.a.createElement("div",{className:"player-status-container"},r.a.createElement("h3",null,"Players:"),r.a.createElement("ul",null,d.players.map(t=>r.a.createElement("li",{key:t.id,className:`${t.isActive?"":"eliminated-player"} ${t.id===d.currentPlayer?"current-turn":""}`},t.name," ",t.id===(null===e||void 0===e?void 0:e.uid)?"(You)":""," - Score: ",t.score||0," ",t.isActive?"":"(Eliminated)")))),!f&&r.a.createElement("p",{className:"eliminated-message"},"You have been eliminated!"),r.a.createElement("p",null,"Current Turn: ",w," ",d.currentPlayer===(null===e||void 0===e?void 0:e.uid)?"(Your Turn)":""),r.a.createElement("div",{className:"sorted-countries-container"},r.a.createElement("h3",null,"Sorted Countries: (",t.length,")"),r.a.createElement("div",{className:"sorted-countries"},j&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>y(0),"aria-label":"Place card at the beginning",disabled:!f},"+"),t.map((e,t)=>r.a.createElement(r.a.Fragment,{key:"sorted-fragment-"+e.id},r.a.createElement(L,{country:e,isClickable:!1,mode:"population"}),j&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>y(t+1),"aria-label":"Place card after "+e.name,disabled:!f},"+"))),0===t.length&&j&&r.a.createElement("button",{className:"place-button plus-button",onClick:()=>y(0),"aria-label":"Place first card",disabled:!f},"+"))),r.a.createElement("div",{className:"remaining-countries"},r.a.createElement("h3",null,"Remaining Countries: (",c.length,")"),r.a.createElement("div",{className:"remaining-countries-grid"},c.map(t=>{const a="placing"===d.mode&&o&&t.id===o.id;return r.a.createElement(L,{key:"remaining-"+t.id,country:t,isClickable:O,onClick:()=>O&&(async t=>{if(!d||!e)return;if(d.currentPlayer!==e.uid)return;if("choosing"!==d.mode)return;const a=d.players.find(t=>t.id===e.uid);if(a&&a.isActive)try{await T.chooseCard(d.lobbyId,e.uid,t)}catch(n){console.error("Error choosing card:",n)}else console.log("Cannot choose card, you are eliminated.")})(t),mode:"population",customClassName:`${a?"selected-for-placing":""} ${f?"":"disabled-card"}`})}))),r.a.createElement("div",{className:"game-instructions"},f&&"choosing"===d.mode&&(h?r.a.createElement("p",null,"Choose a country to place next."):r.a.createElement("p",null,"Waiting for ",w," to choose...")),f&&"placing"===d.mode&&(h?r.a.createElement("p",null,"Place ",null===o||void 0===o?void 0:o.name," in the correct position."):r.a.createElement("p",null,"Waiting for ",w," to place ",null===o||void 0===o?void 0:o.name,"...")),!f&&"completed"!==s&&r.a.createElement("p",null,"Waiting for the remaining players...")))};const z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=JSON.parse(localStorage.getItem("sortly_leaderboard")||"[]");return e?t.filter(t=>t.mode===e):t},q=["population","area"],H={async getTopGames(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;try{const n=Object(v.b)(w,"gameHistory"),r=Object(v.i)(n,Object(v.m)("userId","==",e),Object(v.m)("category","==",t),Object(v.h)("score","desc"),Object(v.g)(a));return(await Object(v.e)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(n){const r=Object(v.i)(Object(v.b)(w,"gameHistory"),Object(v.m)("userId","==",e),Object(v.m)("category","==",t));return(await Object(v.e)(r)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.score-e.score).slice(0,a)}},async getAllTopGames(e){try{const t={};return await Promise.all(q.map(async a=>{t[a]=await this.getTopGames(e,a)})),t}catch(t){return console.error("Error fetching all top games:",t),{}}},async saveGame(e,t,a,n){try{const r=n.map(e=>{let{id:t,name:a,flagUrl:n}=e;return{id:t,name:a,flagUrl:n}});await Object(v.a)(Object(v.b)(w,"gameHistory"),{userId:e,category:t,score:a,countries:r,timestamp:Object(v.j)()})}catch(r){throw console.error("Error saving game history:",r),r}}};a(51),a(52);var Y=function(){const e=Object(u.m)(),t=Object(u.o)(),{currentUser:a}=C(),{score:o=0,message:l="Game Over!",mode:c="unknown",incorrectCountry:i,userOrder:s,correctOrder:m,winnerName:d,finalPlayersState:p}=e.state||{},[g,b]=Object(n.useState)(""),[y,v]=Object(n.useState)(!1),[h,f]=Object(n.useState)(""),E=Object(n.useRef)(!1);return Object(n.useEffect)(()=>{(async()=>{if(a)try{const e=await k.getUserProfile(a.uid);(null===e||void 0===e?void 0:e.nickname)&&b(e.nickname)}catch(e){console.error("Error fetching user profile:",e)}})()},[a]),Object(n.useEffect)(()=>{(async()=>{if(!a||E.current)return;let e=0,t=[];if("classic_population"===c||"cooperation"===c?(e=o-1>=0?o-1:0,t=s||[]):"battleRoyale"===c&&(e=o,t=p?p.map(e=>({name:e.name,score:e.score,isActive:e.isActive})):[]),"unknown"!==c&&(e>0||t.length>0)){if(t.length>0&&(t[0].flagUrl||t[0].name)||e>0)try{console.log("Attempting to save game history:",{userId:a.uid,mode:c,historyScore:e}),await H.saveGame(a.uid,c,e,"classic_population"!==c&&"cooperation"!==c||!s?null:s.map(e=>({id:e.id,name:e.name,flagUrl:e.flagUrl}))),E.current=!0,console.log("Game history saved successfully")}catch(n){console.error("Error saving game history:",n)}else console.log("Skipping game history save: No meaningful data.")}})()},[a,c,o,s,p]),r.a.createElement("div",{className:"game-over-page game-over-"+c}," ",r.a.createElement("h2",null,"Game Over"),r.a.createElement("p",null,l),r.a.createElement("p",null,"classic_population"===c||"cooperation"===c?"Your final score: "+(o-1>=0?o-1:0):"battleRoyale"===c&&d?`${d}'s winning score: ${o}`:"Final Score: "+o),"battleRoyale"===c&&p&&r.a.createElement("div",{className:"final-player-standings"},r.a.createElement("h3",null,"Final Standings:"),r.a.createElement("ul",null,p.sort((e,t)=>(t.score||0)-(e.score||0)).map(e=>r.a.createElement("li",{key:e.id,className:e.isActive?"":"eliminated-player"},e.name,": ",e.score||0," points ",e.isActive?"":"(Eliminated)")))),!y&&("classic_population"===c||"cooperation"===c||"battleRoyale"===c&&o>0)&&r.a.createElement("form",{onSubmit:e=>{if(e.preventDefault(),!g.trim())return void f("Please enter your name");let t=0;if("classic_population"===c||"cooperation"===c?t=o-1>=0?o-1:0:"battleRoyale"===c&&(t=o),t<=0)f("Only scores greater than 0 can be submitted.");else try{((e,t,a)=>{const n=z(),r={id:Date.now(),playerName:e,score:t,mode:a,date:(new Date).toISOString()};n.push(r),n.sort((e,t)=>t.score-e.score);const o=n.slice(0,100);localStorage.setItem("sortly_leaderboard",JSON.stringify(o))})(g,t,c),v(!0),f("")}catch(a){f("Failed to submit score. Please try again.")}},className:"score-submission"},r.a.createElement("div",{className:"input-group"},r.a.createElement("label",{htmlFor:"playerName"},"Enter your name for Leaderboard:"),r.a.createElement("input",{type:"text",id:"playerName",value:g,onChange:e=>b(e.target.value),placeholder:"Your name",maxLength:20,disabled:!a})),!a&&r.a.createElement("p",{className:"info-text"},"Log in to submit your score!"),h&&r.a.createElement("p",{className:"error"},h),r.a.createElement("button",{type:"submit",className:"button button-primary",disabled:!a||!g.trim()},"Submit Score")),y&&r.a.createElement("div",{className:"submission-success"},r.a.createElement("p",null,"Score submitted successfully!")),("classic_population"===c||"classic_area"===c)&&s&&i&&r.a.createElement("div",{className:"user-order"},r.a.createElement("h3",null,"Your order was:"),r.a.createElement("div",{className:"country-list"},s.map(e=>r.a.createElement(L,{key:e.id,country:e,isClickable:!1,highlight:e.id===i.id?"incorrect":"",mode:"classic_population"===c?"population":"area"})))),("classic_population"===c||"classic_area"===c)&&m&&i&&r.a.createElement("div",{className:"correct-order"},r.a.createElement("h3",null,"The correct order was:"),r.a.createElement("div",{className:"country-list"},m.map(e=>r.a.createElement(L,{key:e.id,country:e,isClickable:!1,highlight:e.id===i.id?"correct":"",mode:"classic_population"===c?"population":"area"})))),r.a.createElement("div",{className:"game-over-buttons"},r.a.createElement("button",{className:"button button-primary",onClick:()=>t((()=>{switch(c){case"classic_population":return"/game/population";case"cooperation":return"/game/population/cooperation";case"battleRoyale":return"/game/population/battleroyale";case"classic_area":return"/game/area";default:return"/"}})())},"Play Again ","battleRoyale"===c||"cooperation"===c?"(New Lobby)":""),r.a.createElement("button",{className:"button button-secondary",onClick:()=>t("/")},"Go to Home Page"),r.a.createElement("button",{className:"button button-secondary",onClick:()=>t("/leaderboard")},"View Leaderboard")))};const W=e=>(null===e||void 0===e?void 0:e.toDate)?e.toDate().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):null;a(53);var J=function(){const[e,t]=Object(n.useState)([]),[a,o]=Object(n.useState)([]);Object(n.useEffect)(()=>{(()=>{const e=z("classic_population"),a=z("cooperation_population");t(e),o(a)})()},[]);const l=(e,t)=>r.a.createElement("div",{className:"leaderboard-section"},r.a.createElement("h3",null,e),t.length>0?r.a.createElement("div",{className:"leaderboard-table"},r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Rank"),r.a.createElement("th",null,"Player"),r.a.createElement("th",null,"Score"),r.a.createElement("th",null,"Date"))),r.a.createElement("tbody",null,t.map((e,t)=>r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,t+1),r.a.createElement("td",null,e.playerName),r.a.createElement("td",null,e.score),r.a.createElement("td",null,W(e.date))))))):r.a.createElement("p",null,"No entries yet for this mode."));return r.a.createElement("div",{className:"leaderboard-page"},r.a.createElement("h2",null,"Leaderboard"),l("Classic Population",e),l("Cooperation Population",a))};const K={population:{sorting:{bronze:{id:"population_sorting_bronze",title:"Population Bronze Sorter",description:"Correctly sort 3 countries by population",icon:"\ud83e\udd49",requirement:3},silver:{id:"population_sorting_silver",title:"Population Silver Sorter",description:"Correctly sort 7 countries by population",icon:"\ud83e\udd48",requirement:7},gold:{id:"population_sorting_gold",title:"Population Gold Sorter",description:"Correctly sort 12 countries by population",icon:"\ud83e\udd47",requirement:12},platinum:{id:"population_sorting_platinum",title:"Population Platinum Sorter",description:"Correctly sort 20 countries by population",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"population_games",title:"Population Game Master",description:"Complete 50 population sorting games",icon:"\ud83c\udfae",requirement:50}},area:{sorting:{bronze:{id:"area_sorting_bronze",title:"Area Bronze Sorter",description:"Correctly sort 3 countries by area",icon:"\ud83e\udd49",requirement:3},silver:{id:"area_sorting_silver",title:"Area Silver Sorter",description:"Correctly sort 7 countries by area",icon:"\ud83e\udd48",requirement:7},gold:{id:"area_sorting_gold",title:"Area Gold Sorter",description:"Correctly sort 12 countries by area",icon:"\ud83e\udd47",requirement:12},platinum:{id:"area_sorting_platinum",title:"Area Platinum Sorter",description:"Correctly sort 20 countries by area",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"area_games",title:"Area Game Master",description:"Complete 50 area sorting games",icon:"\ud83c\udfae",requirement:50}}},Z={async getUserAchievements(e){try{const t=await Object(v.d)(Object(v.c)(w,"achievements",e));return t.exists()?t.data():null}catch(t){throw console.error("Error getting user achievements:",t),t}},async updateUserAchievements(e,t){try{await Object(v.k)(Object(v.c)(w,"achievements",e),{...t,updatedAt:Object(v.j)()},{merge:!0})}catch(a){throw console.error("Error updating user achievements:",a),a}},async checkAndUpdateAchievements(e,t,a){try{var n,r;const o=await this.getUserAchievements(e)||{},l=K[t];let c=!1;Object.values(l.sorting).forEach(e=>{!o[e.id]&&a>=e.requirement&&(o[e.id]={unlocked:!0,unlockedAt:Object(v.j)()},c=!0)});const i=l.gameCount,s=((null===(n=o[i.id])||void 0===n?void 0:n.count)||0)+1;return s>=i.requirement&&!(null===(r=o[i.id])||void 0===r?void 0:r.unlocked)?(o[i.id]={unlocked:!0,unlockedAt:Object(v.j)(),count:s},c=!0):(o[i.id]={...o[i.id],count:s},c=!0),c&&await this.updateUserAchievements(e,o),o}catch(o){throw console.error("Error checking achievements:",o),o}},getAchievementDefinitions:()=>K};a(54);var V=e=>{let{avatarOptions:t,selectedAvatar:a,onSelect:n,onClose:o}=e;return r.a.createElement("div",{className:"avatar-selector"},r.a.createElement("div",{className:"avatar-grid"},t.map(e=>r.a.createElement("div",{key:e.id,className:"avatar-option "+(a===e.url?"selected":""),onClick:()=>n(e.url)},r.a.createElement("img",{src:e.url,alt:e.name}),r.a.createElement("span",null,e.name)))))};a(55);var X=e=>{let{profile:t,currentUser:a,avatarOptions:o,onSubmit:l}=e;const[c,i]=Object(n.useState)({nickname:(null===t||void 0===t?void 0:t.nickname)||"",country:(null===t||void 0===t?void 0:t.country)||"",avatarUrl:(null===t||void 0===t?void 0:t.avatarUrl)||o[0].url}),[s,u]=Object(n.useState)(!1),[m,d]=Object(n.useState)(!1),p=e=>{const{name:t,value:a}=e.target;i(e=>({...e,[t]:a})),d(!0)};return r.a.createElement("div",{className:"profile-header"},r.a.createElement("div",{className:"avatar-container"},r.a.createElement("img",{src:c.avatarUrl,alt:"Profile",className:"profile-avatar",onClick:()=>u(!0)}),s&&r.a.createElement(V,{avatarOptions:o,selectedAvatar:c.avatarUrl,onSelect:e=>{i(t=>({...t,avatarUrl:e})),u(!1),d(!0)},onClose:()=>u(!1)})),r.a.createElement("div",{className:"profile-info"},r.a.createElement("form",{onSubmit:async e=>{e.preventDefault();try{await l(c),d(!1)}catch(t){console.error("Error saving profile:",t)}},className:"profile-form"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",name:"nickname",value:c.nickname,onChange:p,placeholder:"Set your nickname",className:"inline-input"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",name:"country",value:c.country,onChange:p,placeholder:"Set your country",className:"inline-input"})),r.a.createElement("div",{className:"email-display"},a.email),m&&r.a.createElement("button",{type:"submit",className:"save-button"},"Save Changes"))))};a(56);var Q=e=>{let{achievement:t,isUnlocked:a,unlockDate:n}=e;return r.a.createElement("div",{className:"achievement-card "+(a?"unlocked":"locked")},r.a.createElement("div",{className:"achievement-content"},r.a.createElement("div",{className:"achievement-icon"},t.icon),r.a.createElement("div",{className:"achievement-info"},r.a.createElement("h3",null,t.title),r.a.createElement("p",null,t.description),a&&n&&r.a.createElement("div",{className:"achievement-date"},"Unlocked: ",W(n)))),r.a.createElement("div",{className:"achievement-status"},a?"\u2713":"\ud83d\udd12"))};a(57);var ee=e=>{let{achievementDefinitions:t,achievements:a}=e;const n=(e=>{const t=[];return Object.entries(e).forEach(e=>{let[a,n]=e;Object.entries(n.sorting).forEach(e=>{let[n,r]=e;t.push({...r,category:a,type:"sorting"})}),n.gameCount&&t.push({...n.gameCount,category:a,type:"gameCount"})}),t})(t);return r.a.createElement("div",{className:"achievements-section"},r.a.createElement("h2",null,"Achievements"),r.a.createElement("div",{className:"achievements-grid"},n.map(e=>{var t,n,o;return r.a.createElement(Q,{key:e.id,achievement:e,isUnlocked:null!==(t=null===a||void 0===a||null===(n=a[e.id])||void 0===n?void 0:n.unlocked)&&void 0!==t&&t,unlockDate:null===a||void 0===a||null===(o=a[e.id])||void 0===o?void 0:o.unlockedAt})})))};a(58);var te=e=>{var t,a;let{game:n,index:o}=e;return r.a.createElement("div",{className:"game-history-item"},r.a.createElement("div",{className:"game-rank"},"#",o+1),r.a.createElement("div",{className:"game-score"},"Score: ",n.score),r.a.createElement("div",{className:"game-mode"},n.category.charAt(0).toUpperCase()+n.category.slice(1)," Mode"),r.a.createElement("div",{className:"game-date"},(null===(t=n.timestamp)||void 0===t?void 0:t.toDate)?W(n.timestamp):"Date unavailable"),r.a.createElement("div",{className:"game-countries"},null===(a=n.countries)||void 0===a?void 0:a.map((e,t)=>r.a.createElement("div",{key:t,className:"country-item"},r.a.createElement("img",{src:e.flagUrl,alt:e.name,className:"country-flag"}),r.a.createElement("span",null,e.name)))))};a(59);var ae=e=>{let{gameHistory:t}=e;const a=Object(n.useMemo)(()=>{if(!t||0===Object.keys(t).length)return[];return Object.entries(t).flatMap(e=>{let[t,a]=e;return a.map(e=>({...e,category:t}))}).filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)).sort((e,t)=>t.score-e.score).slice(0,5)},[t]);return t?0===Object.keys(t).length?r.a.createElement("div",{className:"game-history-section"},r.a.createElement("h2",null,"Best 5 Games"),r.a.createElement("p",null,"No games played yet. Start playing to see your best games here!")):r.a.createElement("div",{className:"game-history-section"},r.a.createElement("h2",null,"Best 5 Games"),r.a.createElement("div",{className:"game-history-list"},a.map((e,t)=>r.a.createElement(te,{key:e.id,game:e,index:t})))):r.a.createElement("div",{className:"game-history-section"},r.a.createElement("h2",null,"Best 5 Games"),r.a.createElement("p",null,"Loading game history..."))};a(60);var ne=()=>{const{currentUser:e}=C(),t=Object(u.o)(),[a,o]=Object(n.useState)(null),[l,c]=Object(n.useState)(null),[i,s]=Object(n.useState)(null),[m,d]=Object(n.useState)(!0),[p,g]=Object(n.useState)(""),[b,y]=Object(n.useState)(!1),[v,h]=Object(n.useState)(!1),[f,E]=Object(n.useState)({nickname:"",country:"",avatarUrl:""}),w=S.getAvatarOptions(),O=Z.getAchievementDefinitions(),j=null===e||void 0===e?void 0:e.uid,N=Object(n.useCallback)(async()=>{if(j)try{const[e,t,a]=await Promise.all([k.getUserProfile(j),Z.getUserAchievements(j),H.getAllTopGames(j)]);e&&(o(e),E({nickname:e.nickname||"",country:e.country||"",avatarUrl:e.avatarUrl||w[0].url})),c(t),s(a)}catch(p){g("Failed to load profile: "+p.message)}finally{d(!1)}},[j,w]);Object(n.useEffect)(()=>{e&&N()},[e,N]);return e?m?r.a.createElement("div",{className:"profile-page"},"Loading..."):r.a.createElement("div",{className:"profile-page"},r.a.createElement("div",{className:"profile-content"},r.a.createElement(X,{profile:a,currentUser:e,editing:b,formData:f,avatarOptions:w,showAvatarSelector:v,onEdit:()=>y(!0),onAvatarSelect:e=>{E(t=>({...t,avatarUrl:e})),h(!1)},onAvatarSelectorToggle:()=>h(!v),onSubmit:async t=>{t.preventDefault();try{g(""),await k.updateUserProfile(e.uid,f),o(e=>({...e,...f})),y(!1)}catch(p){g("Failed to update profile: "+p.message)}},onChange:e=>{const{name:t,value:a}=e.target;E(e=>({...e,[t]:a}))},onCancel:()=>y(!1)}),p&&r.a.createElement("div",{className:"error-message"},p),r.a.createElement(ee,{achievementDefinitions:O,achievements:l}),r.a.createElement(ae,{gameHistory:i}))):(t("/"),null)};const re=new class{constructor(){this.lobbiesRef=Object(h.e)(O,"lobbies")}async createLobby(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cooperation";const n=Object(h.e)(O,"lobbies/"+e);return await Object(h.g)(n,{players:[t],status:"waiting",gameMode:a,createdAt:Date.now(),lastUpdated:Date.now()}),e}async joinLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),n=(await Object(h.a)(a)).val();if(!n)throw new Error("Lobby not found");{const r=n.players||[];if(r.some(e=>e.id===t.id))return void console.warn(`Player ${t.id} already in lobby ${e}.`);await Object(h.h)(a,{players:[...r,t],lastUpdated:Date.now()})}}async leaveLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),n=(await Object(h.a)(a)).val();if(n){const r=(n.players||[]).filter(e=>e.id!==t);if(0===r.length)console.log(`Last player left lobby ${e}. Deleting lobby.`),await Object(h.f)(a);else{let e={players:r,lastUpdated:Date.now()};await Object(h.h)(a,e)}}else console.warn("Attempted to leave non-existent or already deleted lobby: "+e)}subscribeToLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),n=Object(h.d)(a,e=>{const a=e.val();t(a)},a=>{console.error(`Error subscribing to lobby ${e}:`,a),t(null)});return()=>Object(h.c)(a,"value",n)}async startGame(e){const t=Object(h.e)(O,"lobbies/"+e);await Object(h.h)(t,{status:"playing",startedAt:Date.now(),lastUpdated:Date.now()})}async endGame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Object(h.e)(O,"lobbies/"+e);await Object(h.h)(a,{status:"completed",result:t,endedAt:Date.now(),lastUpdated:Date.now()})}async cleanupLobby(e){console.log("Cleaning up lobby: "+e);const t=Object(h.e)(O,"lobbies/"+e);await Object(h.f)(t)}};a(61);const oe={cooperation:{minPlayers:2,maxPlayers:4,service:F,name:"Cooperation Mode"},battleRoyale:{minPlayers:2,maxPlayers:8,service:T,name:"Battle Royale Mode"}};var le=function(){const{currentUser:e}=C(),[t,a]=Object(n.useState)(""),[o,l]=Object(n.useState)([]),[i,s]=Object(n.useState)(!1),[m,d]=Object(n.useState)(""),[p,g]=Object(n.useState)(""),[b,y]=Object(n.useState)(null),v=Object(u.o)(),h=Object(u.m)(),[f]=Object(c.c)(),E=Object(n.useRef)(""),w=Object(n.useRef)(null);if(Object(n.useEffect)(()=>{const e=(e=>{const t=e.toLowerCase();return t.includes("/cooperation")?"cooperation":t.includes("/battleroyale")?"battleRoyale":null})(h.pathname);e?(y(e),d("")):(console.error("Invalid game mode in URL path:",h.pathname),d("Invalid game mode specified in URL."))},[h.pathname]),Object(n.useEffect)(()=>{if(!b||!e)return;let t=null,n=!0;return(async()=>{try{let i="";try{const t=await k.getUserProfile(e.uid);i=(null===t||void 0===t?void 0:t.nickname)||""}catch(r){console.error("Error fetching user profile:",r)}const u=f.get("lobby");let m="",p={id:e.uid,name:i||(u?"Player "+Math.floor(100*Math.random()):"Player 1"),email:e.email};if(w.current=p,u){m=u,E.current=m,n&&(a(m),s(!1));try{await re.joinLobby(m,p)}catch(o){return console.error("Error joining lobby:",o),void(n&&d(o.message||"Failed to join lobby"))}}else{m=Math.random().toString(36).substring(2,8).toUpperCase(),E.current=m,n&&(a(m),s(!0));try{await re.createLobby(m,p,b)}catch(c){return console.error("Error creating lobby:",c),void(n&&d(c.message||"Failed to create lobby"))}}t=re.subscribeToLobby(m,t=>{var a;if(n)if(t){if(l(t.players||[]),s(t.players&&(null===(a=t.players[0])||void 0===a?void 0:a.id)===e.uid),"playing"===t.status)if(b){const e=`/game/population/${b}/play`;try{console.log(`Navigating to ${e} with mode ${b}`),v(e,{state:{lobbyId:m,players:t.players,gameMode:b}})}catch(r){console.error("Navigation error:",r)}}else console.error("Cannot navigate, gameMode state is null/undefined."),d("Error determining game mode for navigation.")}else d("Lobby not found or has been closed")})}catch(m){console.error("Error initializing lobby:",m),n&&d("Failed to initialize lobby")}})(),()=>{n=!1,t&&t(),E.current&&w.current&&re.leaveLobby(E.current,w.current.id)}},[b,f,e,v]),!b)return r.a.createElement("div",{className:"game-lobby"},"Determining game mode... ",m&&r.a.createElement("p",{className:"error-message"},m));if(!e)return r.a.createElement("div",{className:"game-lobby"},"Please log in...");const O=oe[b];return r.a.createElement("div",{className:"game-lobby"},r.a.createElement("h2",null,(null===O||void 0===O?void 0:O.name)||"Game Lobby"),m&&r.a.createElement("p",{className:"error-message"},m),r.a.createElement("div",{className:"lobby-info"},r.a.createElement("p",null,"Lobby ID: ",r.a.createElement("strong",null,t)),i&&r.a.createElement("button",{className:"button button-secondary copy-button "+(p?"copied":""),onClick:async()=>{if(!b||!E.current)return;const e=`${window.location.origin}/#/game/population/${b}?lobby=${encodeURIComponent(E.current)}`;try{await navigator.clipboard.writeText(e),g("Copied!"),setTimeout(()=>g(""),2e3)}catch(t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),g("Copied!"),setTimeout(()=>g(""),2e3)}catch(a){g("Failed to copy"),console.error("Fallback copy failed: ",a)}document.body.removeChild(n)}},disabled:!t},p||"Copy Invite Link")),r.a.createElement("div",{className:"player-list"},r.a.createElement("h3",null,"Players (",o.length,"/",(null===O||void 0===O?void 0:O.maxPlayers)||"N/A","):"),r.a.createElement("ul",null,o.map((t,a)=>r.a.createElement("li",{key:t.id||a},t.name," ",t.id===(null===e||void 0===e?void 0:e.uid)?"(You)":""," ",0===a?"(Host)":""))),o.length<(null===O||void 0===O?void 0:O.minPlayers)&&r.a.createElement("p",{className:"waiting-message"},"Waiting for at least ",O.minPlayers," players...")),i&&r.a.createElement("button",{className:"button button-primary start-button",onClick:async()=>{if(!i||!b||!E.current)return;const e=oe[b];if(e)if(o.length<e.minPlayers)d(`Waiting for more players. Need at least ${e.minPlayers}.`);else if(o.length>e.maxPlayers)d(`Too many players. Maximum is ${e.maxPlayers}.`);else try{d(""),await e.service.initializeGameState(E.current,o),await re.startGame(E.current)}catch(m){console.error("Error starting game:",m),d(m.message||"Failed to start game")}else d("Invalid game mode configuration.")},disabled:o.length<(null===O||void 0===O?void 0:O.minPlayers)||o.length>(null===O||void 0===O?void 0:O.maxPlayers)},"Start Game"),!i&&r.a.createElement("p",null,"Waiting for the host to start the game..."))};const ce={async addScore(e,t,a,n){try{return(await Object(v.a)(Object(v.b)(w,"scores"),{userId:e,username:t,score:a,gameMode:n,timestamp:Object(v.j)()})).id}catch(r){throw console.error("Error adding score:",r),r}},async getGlobalLeaderboard(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;try{const t=Object(v.i)(Object(v.b)(w,"scores"),Object(v.h)("score","desc"),e(e));return(await Object(v.e)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){throw console.error("Error getting leaderboard:",t),t}},async getUserBestScores(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{const a=Object(v.i)(Object(v.b)(w,"scores"),Object(v.m)("userId","==",e),Object(v.h)("score","desc"),t(t));return(await Object(v.e)(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(a){throw console.error("Error getting user scores:",a),a}}};function ie(){const{currentUser:e,login:t,signup:a,logout:o}=C(),[l,c]=Object(n.useState)(""),[i,s]=Object(n.useState)(""),[u,m]=Object(n.useState)(""),[d,p]=Object(n.useState)(!1),[g,b]=Object(n.useState)(null);return r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("h2",null,"Firebase Test"),e?r.a.createElement("div",null,r.a.createElement("p",null,"Logged in as: ",e.email),r.a.createElement("button",{onClick:async function(){try{m(""),p(!0),await o()}catch(u){m("Failed to log out: "+u.message)}p(!1)},disabled:d},"Log Out"),r.a.createElement("button",{onClick:async function(){if(e)try{await ce.addScore(e.uid,e.email,100,"test"),b("Score added successfully!")}catch(u){b("Failed to add score: "+u.message)}},style:{marginLeft:"10px"}},"Add Test Score"),g&&r.a.createElement("p",null,g)):r.a.createElement("div",null,r.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{m(""),p(!0),await a(l,i)}catch(u){m("Failed to create an account: "+u.message)}p(!1)}},r.a.createElement("input",{type:"email",value:l,onChange:e=>c(e.target.value),placeholder:"Email",required:!0}),r.a.createElement("input",{type:"password",value:i,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),r.a.createElement("button",{type:"submit",disabled:d},"Sign Up")),r.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{m(""),p(!0),await t(l,i)}catch(u){m("Failed to log in: "+u.message)}p(!1)},style:{marginTop:"10px"}},r.a.createElement("button",{type:"submit",disabled:d},"Log In"))),u&&r.a.createElement("p",{style:{color:"red"}},u))}a(62);var se=function(){const e=Object(u.m)();return Object(n.useEffect)(()=>{d.a.initialize("G-9679TPXEBR")},[]),Object(n.useEffect)(()=>{d.a.send({hitType:"pageview",page:e.pathname})},[e.pathname]),r.a.createElement(N,null,r.a.createElement("div",{className:"App"},r.a.createElement(A,null),r.a.createElement("div",{className:"content"},r.a.createElement(u.c,null,r.a.createElement(u.a,{path:"/",element:r.a.createElement(R,null)}),r.a.createElement(u.a,{path:"/game/population",element:r.a.createElement($,null)}),r.a.createElement(u.a,{path:"/game/population/cooperation",element:r.a.createElement(le,null)}),r.a.createElement(u.a,{path:"/game/population/cooperation/play",element:r.a.createElement(M,null)}),r.a.createElement(u.a,{path:"/game/population/battleroyale",element:r.a.createElement(le,null)}),r.a.createElement(u.a,{path:"/game/population/battleroyale/play",element:r.a.createElement(B,null)}),r.a.createElement(u.a,{path:"/gameover",element:r.a.createElement(Y,null)}),r.a.createElement(u.a,{path:"/leaderboard",element:r.a.createElement(J,null)}),r.a.createElement(u.a,{path:"/profile",element:r.a.createElement(ne,null)}),r.a.createElement(u.a,{path:"/test",element:r.a.createElement(ie,null)}))),r.a.createElement(U,null)))};a(63);l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,null,r.a.createElement(i.a,{backend:s.a},r.a.createElement(se,null)))))}],[[32,1,2]]]);
//# sourceMappingURL=main.2af59ead.chunk.js.map