(this["webpackJsonpsortly-de"]=this["webpackJsonpsortly-de"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"static/media/logo.3de73253.png"},,,,,,,,function(e,t,a){e.exports=a.p+"static/media/population.b123bcc2.jpg"},function(e,t,a){e.exports=a.p+"static/media/area.1a41ffef.jpg"},,,,,function(e,t,a){e.exports=a(65)},,,,,,,,,,function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(22),c=a.n(o),l=a(10),i=a(69),s=a(29),m=a(3),u=a(14),d=a.n(u),b=(a(41),a(17)),p=a.n(b),g=a(15),y=a(24),v=a(5),E=a(7);const h=Object(y.a)({apiKey:"AIzaSyAOZkZ8FGkHv6J4xD-yckuKOasuO4zEF2c",authDomain:"sortly-1b701.firebaseapp.com",projectId:"sortly-1b701",storageBucket:"sortly-1b701.firebasestorage.app",messagingSenderId:"37869262835",appId:"1:37869262835:web:9d463c1b217727d88e6486",databaseURL:"https://sortly-1b701-default-rtdb.europe-west1.firebasedatabase.app"}),f=Object(g.b)(h),O=Object(v.f)(h),j=Object(E.b)(h);const w=Object(r.createContext)();function N(){return Object(r.useContext)(w)}function C(e){let{children:t}=e;const[a,o]=Object(r.useState)(null),[c,l]=Object(r.useState)(!0);Object(r.useEffect)(()=>Object(g.c)(f,e=>{o(e),l(!1)}),[]);const i={currentUser:a,signup:function(e,t){return Object(g.a)(f,e,t)},login:function(e,t){return Object(g.d)(f,e,t)},logout:function(){return Object(g.e)(f)}};return n.a.createElement(w.Provider,{value:i},!c&&t)}const S={getAvatarOptions:()=>[{id:"default",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=default",name:"Default"},{id:"happy",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=happy",name:"Happy"},{id:"cool",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=cool",name:"Cool"},{id:"smart",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=smart",name:"Smart"},{id:"friendly",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=friendly",name:"Friendly"},{id:"adventurous",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=adventurous",name:"Adventurous"},{id:"creative",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=creative",name:"Creative"},{id:"mysterious",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=mysterious",name:"Mysterious"}]},k={async getUserProfile(e){try{const t=await Object(v.d)(Object(v.c)(O,"users",e));if(t.exists())return t.data();const a={nickname:"",country:"",avatarUrl:S.getAvatarOptions()[0].url,createdAt:new Date};return await this.updateUserProfile(e,a),a}catch(t){throw console.error("Error getting user profile:",t),t}},async updateUserProfile(e,t){try{const a=Object(v.c)(O,"users",e);await Object(v.k)(a,{...t,updatedAt:new Date},{merge:!0})}catch(a){throw console.error("Error updating user profile:",a),a}},async updateProfileField(e,t,a){try{const r=Object(v.c)(O,"users",e);await Object(v.l)(r,{[t]:a,updatedAt:new Date})}catch(r){throw console.error("Error updating profile field:",r),r}}};a(46);function U(){const{currentUser:e,login:t,signup:a,logout:o}=N(),[c,l]=Object(r.useState)(""),[i,s]=Object(r.useState)(""),[u,d]=Object(r.useState)(""),[b,p]=Object(r.useState)(!1),[g,y]=Object(r.useState)(!1),[v,E]=Object(r.useState)(null),h=Object(m.o)();return Object(r.useEffect)(()=>{(async()=>{if(e)try{const t=await k.getUserProfile(e.uid);E(t)}catch(u){console.error("Error loading user profile:",u)}})()},[e]),e?n.a.createElement("div",{className:"login-button"},n.a.createElement("div",{className:"user-profile-button",onClick:()=>h("/profile")},n.a.createElement("img",{src:(null===v||void 0===v?void 0:v.avatarUrl)||S.getAvatarOptions()[0].url,alt:"Profile",className:"header-avatar"}),n.a.createElement("span",{className:"user-name"},(null===v||void 0===v?void 0:v.nickname)||e.email)),n.a.createElement("button",{onClick:async function(){try{d(""),p(!0),await o(),h("/")}catch(u){d("Failed to log out: "+u.message)}p(!1)},disabled:b,className:"logout-button"},"Log Out")):n.a.createElement("div",{className:"login-button"},g?n.a.createElement("div",{className:"login-form"},n.a.createElement("input",{type:"email",value:c,onChange:e=>l(e.target.value),placeholder:"Email",required:!0}),n.a.createElement("input",{type:"password",value:i,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),n.a.createElement("div",{className:"login-buttons"},n.a.createElement("button",{onClick:async function(e){e.preventDefault();try{d(""),p(!0),await t(c,i),y(!1),h("/profile")}catch(u){d("Failed to log in: "+u.message)}p(!1)},disabled:b},"Login"),n.a.createElement("button",{onClick:async function(e){e.preventDefault();try{d(""),p(!0),await a(c,i),y(!1),h("/profile")}catch(u){d("Failed to create an account: "+u.message)}p(!1)},disabled:b},"Sign Up"),n.a.createElement("button",{onClick:()=>y(!1)},"Cancel")),u&&n.a.createElement("p",{style:{color:"red"}},u)):n.a.createElement("button",{onClick:()=>y(!0)},"Login / Sign Up"))}var P=function(){const[e,t]=Object(r.useState)(!1),a=()=>{t(!1)};return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"header-container"},n.a.createElement(l.b,{to:"/",className:"header-logo",onClick:a},n.a.createElement("img",{src:p.a,alt:"Sortly Logo",className:"logo-image"}),n.a.createElement("span",{className:"site-name"},"Sortly - The Sorting Game")),n.a.createElement("button",{className:"menu-button",onClick:()=>{t(!e)}},"\u2630"),n.a.createElement("nav",{className:"header-nav "+(e?"active":"")},n.a.createElement(l.b,{to:"/",className:"nav-link",onClick:a},"Home"),n.a.createElement(l.b,{to:"/game/population",className:"nav-link",onClick:a},"Population"),n.a.createElement(l.b,{to:"/game/area",className:"nav-link",onClick:a},"Area"),n.a.createElement(l.b,{to:"/leaderboard",className:"nav-link",onClick:a},"Leaderboard"),n.a.createElement("div",{className:"nav-login"},n.a.createElement(U,null)))))};a(47);var A=function(){return n.a.createElement("footer",{className:"footer"},n.a.createElement("div",{className:"footer-container"},n.a.createElement("img",{src:p.a,alt:"Sortly Logo",className:"footer-logo"}),n.a.createElement("p",null,"\xa9 ",(new Date).getFullYear()," Sortly. All rights reserved.")))},G=a(25),D=a.n(G),L=a(26),x=a.n(L);a(48);var I=function(){const e=Object(m.o)();return n.a.createElement("div",{className:"homepage"},n.a.createElement("div",{className:"section population-section",style:{backgroundImage:`url(${D.a})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},n.a.createElement("div",{className:"overlay"},n.a.createElement("h2",null,"Sort by Population"),n.a.createElement("div",{className:"population-modes"},n.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Population Game"}),e("/game/population")}},"Classic Mode"),n.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Cooperation Game"}),e("/game/population/cooperation")}},"Cooperation Mode")))),n.a.createElement("div",{className:"section area-section",style:{backgroundImage:`url(${x.a})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},n.a.createElement("div",{className:"overlay"},n.a.createElement("h2",null,"Sort by Area"),n.a.createElement("button",{className:"button button-primary",onClick:()=>{d.a.event({category:"Game",action:"Clicked Play Area Game"}),e("/game/area")}},"Play Now"))))};a(49);var F=function(e){let{country:t,isClickable:a,highlight:o,mode:c,onClick:l}=e;const[i,s]=Object(r.useState)(!1),m=o?"highlighted-"+o:"";return n.a.createElement("div",{className:`country-card ${i?"flipped":""} ${a?"clickable":""} ${m}`,onClick:()=>{l?a&&l():a&&s(!i)}},n.a.createElement("div",{className:"card-inner"},n.a.createElement("div",{className:"card-face card-front "+m},n.a.createElement("img",{src:t.flagUrl,alt:"Flag of "+t.name,className:"country-flag"}),n.a.createElement("div",{className:"country-info"},n.a.createElement("h3",{className:"country-name"},t.name))),n.a.createElement("div",{className:"card-face card-back "+m},n.a.createElement("div",{className:"country-info"},n.a.createElement("h3",{className:"country-name"},t.name),n.a.createElement("p",{className:"country-detail"},{population:"Population: "+t.population.toLocaleString(),area:`Area: ${t.area.toLocaleString()} km\xb2`}[c]||"")))))};a(50);const T={async initializeGameState(e,t){let a;try{if(a=await(async()=>{try{const e=await fetch("https://restcountries.com/v3.1/all");if(!e.ok)throw new Error("HTTP error! status: "+e.status);const t=await e.json();if(!Array.isArray(t))throw new Error("Invalid data format received from API");const a=t.filter(e=>{var t,a;return e.unMember&&(null===(t=e.name)||void 0===t?void 0:t.common)&&(null===(a=e.flags)||void 0===a?void 0:a.svg)&&"number"===typeof e.population&&"number"===typeof e.area});return a.map((e,t)=>({id:t+1,name:e.name.common,flagUrl:e.flags.svg,population:e.population,area:e.area}))}catch(e){throw console.error("Error fetching countries:",e),new Error("Failed to fetch countries data. Please try again later.")}})(),!a||a.length<11)throw new Error("Not enough valid countries fetched to start cooperation mode.")}catch(i){throw console.error("Failed to fetch countries for initialization:",i),new Error("Could not fetch country data to start the game.")}const r=((e,t)=>{t>e.length&&(console.warn("Requested more elements than available"),t=e.length);return[...e].sort(()=>.5-Math.random()).slice(0,t)})(a,11),n=r[0],o=r.slice(1),c=Object(E.e)(j,"gameStates/"+e),l={lobbyId:e,currentPlayer:t[0].id,players:t,mode:"choosing",sortedCountries:[n],remainingCountries:o,currentCountry:null,score:1,status:"playing",createdAt:Date.now(),lastUpdated:Date.now()};await Object(E.g)(c,l),console.log("Initialized game state for lobby",e,l)},subscribeToGameState(e,t){const a=Object(E.e)(j,"gameStates/"+e),r=Object(E.d)(a,e=>{const a=e.val();t(a)},e=>{console.error("Error subscribing to game state:",e),t(null)});return()=>Object(E.c)(a,"value",r)},async updateGameState(e,t){const a=Object(E.e)(j,"gameStates/"+e);await Object(E.h)(a,{...t,lastUpdated:Date.now()})},async chooseCard(e,t,a){const r=Object(E.e)(j,"gameStates/"+e),n=(await Object(E.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("choosing"!==n.mode)throw new Error("Not in choosing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to choose");if(!n.remainingCountries||!n.remainingCountries.some(e=>e.id===a.id))throw console.error("Chosen country not found in remaining:",a,n.remainingCountries),new Error("Chosen country is not in the remaining inventory");const o=n.remainingCountries.filter(e=>e.id!==a.id);await Object(E.h)(r,{currentCountry:a,remainingCountries:o,mode:"placing",lastUpdated:Date.now()})},async placeCard(e,t,a){const r=Object(E.e)(j,"gameStates/"+e),n=(await Object(E.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("placing"!==n.mode)throw new Error("Not in placing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to place");if(!n.currentCountry)throw new Error("No country currently chosen for placement");if((e=>{for(let t=0;t<e.length-1;t++)if(!e[t]||!e[t+1]||e[t].population>e[t+1].population)return!1;return!0})(a.sortedCountries)){var o,c;const e={currentPlayer:(null===(o=n.players.find(e=>e.id!==t))||void 0===o?void 0:o.id)||(null===(c=n.players[0])||void 0===c?void 0:c.id),sortedCountries:a.sortedCountries,currentCountry:null,mode:"choosing",score:n.score+1,lastUpdated:Date.now()};0===n.remainingCountries.length&&(e.status="completed",e.result="win",e.mode="finished"),await Object(E.h)(r,e)}else console.log(`Incorrect placement by ${t}. Ending game.`),await this.endGame(e)},async endGame(e){const t=Object(E.e)(j,"gameStates/"+e),a=await Object(E.a)(t);a.exists()&&"playing"===a.val().status?(await Object(E.h)(t,{status:"completed",result:"lose",mode:"finished",currentCountry:null,lastUpdated:Date.now()}),console.log("Game ended with lose state for lobby:",e)):console.log("Game already completed or does not exist, skipping endGame call for lobby:",e)},async cleanupGameState(e){const t=Object(E.e)(j,"gameStates/"+e);await Object(E.g)(t,null)}};var _=function(){var e;const{currentUser:t}=N(),[a,o]=Object(r.useState)([]),[c,l]=Object(r.useState)(null),[i,s]=Object(r.useState)([]),[u,d]=Object(r.useState)(0),[b,p]=Object(r.useState)("waiting"),[g,y]=Object(r.useState)(null),v=Object(m.o)(),E=Object(m.m)();Object(r.useEffect)(()=>{const{lobbyId:e}=E.state||{};if(!e)return console.error("No lobbyId found in location state. Navigating away."),void v("/");const t=T.subscribeToGameState(e,t=>{if(t){if(y(t),d(void 0!==t.score?t.score:0),o(t.sortedCountries||[]),l(t.currentCountry||null),s(t.remainingCountries||[]),p(t.status||"waiting"),"completed"===t.status){let e="Game Over!";"win"===t.result?e="Congratulations! You sorted all countries correctly.":"lose"===t.result&&(e="Game Over! An incorrect move was made."),v("/gameover",{state:{score:t.score||0,message:e},replace:!0})}}else console.error("Game state not found for lobby:",e),v("/")});return()=>t()},[E.state,v,t]);const h=async e=>{if(!g||!t||!c)return;if(g.currentPlayer!==t.uid)return;if("placing"!==g.mode)return;const r=[...a];r.splice(e,0,c);try{await T.placeCard(g.lobbyId,t.uid,{sortedCountries:r})}catch(n){console.error("Error placing card:",n)}};if(!g||"waiting"===b)return n.a.createElement("div",{className:"game-page"},"Loading Game...");const f=g.currentPlayer===(null===t||void 0===t?void 0:t.uid),O=(null===(e=g.players.find(e=>e.id===g.currentPlayer))||void 0===e?void 0:e.name)||"Unknown";return n.a.createElement("div",{className:"game-page"},n.a.createElement("h2",null,"Cooperation Mode"),n.a.createElement("p",null,"Current Turn: ",O),n.a.createElement("p",null,"Score: ",u),n.a.createElement("div",{className:"sorted-countries-container"},n.a.createElement("h3",null,"Sorted Countries:"),n.a.createElement("div",{className:"sorted-countries"},a.map((e,t)=>n.a.createElement(F,{key:"sorted-"+e.id,country:e,isClickable:!1,mode:"population"}))),"placing"===g.mode&&f&&c&&n.a.createElement("div",{className:"insert-buttons"},n.a.createElement("button",{className:"insert-button",onClick:()=>h(0)},"Place at Start \u2193"),a.map((e,t)=>n.a.createElement("button",{key:"insert-"+t,className:"insert-button",onClick:()=>h(t+1)},"Place Here")))),"placing"===g.mode&&c&&n.a.createElement("div",{className:"current-country"},n.a.createElement("h3",null,f?"Your Country to Place:":O+"'s Country to Place:"),n.a.createElement(F,{country:c,isClickable:!1,mode:"population"})),n.a.createElement("div",{className:"remaining-countries"},n.a.createElement("h3",null,"Remaining Countries to Sort: (",i.length,")"),n.a.createElement("div",{className:"remaining-countries-grid"},i.map(e=>n.a.createElement(F,{key:"remaining-"+e.id,country:e,isClickable:"choosing"===g.mode&&f,onClick:()=>"choosing"===g.mode&&f&&(async e=>{if(g&&t&&g.currentPlayer===t.uid&&"choosing"===g.mode)try{await T.chooseCard(g.lobbyId,t.uid,e)}catch(a){console.error("Error choosing card:",a)}})(e),mode:"population"})))),n.a.createElement("div",{className:"game-instructions"},"choosing"===g.mode&&(f?n.a.createElement("p",null,"Choose a country from the remaining countries to place next."):n.a.createElement("p",null,"Waiting for ",O," to choose a country...")),"placing"===g.mode&&(f?n.a.createElement("p",null,"Place ",null===c||void 0===c?void 0:c.name," in the correct position based on population."):n.a.createElement("p",null,"Waiting for ",O," to place ",null===c||void 0===c?void 0:c.name,"..."))))};const q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=JSON.parse(localStorage.getItem("sortly_leaderboard")||"[]");return e?t.filter(t=>t.mode===e):t},z=["population","area"],M={async getTopGames(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;try{const r=Object(v.b)(O,"gameHistory"),n=Object(v.i)(r,Object(v.m)("userId","==",e),Object(v.m)("category","==",t),Object(v.h)("score","desc"),Object(v.g)(a));return(await Object(v.e)(n)).docs.map(e=>({id:e.id,...e.data()}))}catch(r){const n=Object(v.i)(Object(v.b)(O,"gameHistory"),Object(v.m)("userId","==",e),Object(v.m)("category","==",t));return(await Object(v.e)(n)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.score-e.score).slice(0,a)}},async getAllTopGames(e){try{const t={};return await Promise.all(z.map(async a=>{t[a]=await this.getTopGames(e,a)})),t}catch(t){return console.error("Error fetching all top games:",t),{}}},async saveGame(e,t,a,r){try{const n=r.map(e=>{let{id:t,name:a,flagUrl:r}=e;return{id:t,name:a,flagUrl:r}});await Object(v.a)(Object(v.b)(O,"gameHistory"),{userId:e,category:t,score:a,countries:n,timestamp:Object(v.j)()})}catch(n){throw console.error("Error saving game history:",n),n}}};a(51),a(52);var R=function(){const e=Object(m.m)(),t=Object(m.o)(),{currentUser:a}=N(),{score:o,message:c,incorrectCountry:l,userOrder:i,correctOrder:s,mode:u}=e.state||{},[d,b]=Object(r.useState)(""),[p,g]=Object(r.useState)(!1),[y,v]=Object(r.useState)(""),E=Object(r.useRef)(!1);return Object(r.useEffect)(()=>{(async()=>{if(a)try{const e=await k.getUserProfile(a.uid);(null===e||void 0===e?void 0:e.nickname)&&b(e.nickname)}catch(y){console.error("Error fetching user profile:",y)}})()},[a]),Object(r.useEffect)(()=>{(async()=>{if(a&&i&&!E.current)try{console.log("Attempting to save game history:",{userId:a.uid,mode:u,score:o-1,countriesCount:i.length}),await M.saveGame(a.uid,u,o-1,i.map(e=>({id:e.id,name:e.name,flagUrl:e.flagUrl}))),E.current=!0,console.log("Game history saved successfully")}catch(y){console.error("Error saving game history:",y)}})()},[a,i,u,o]),n.a.createElement("div",{className:"game-over-page"},n.a.createElement("h2",null,"Game Over"),n.a.createElement("p",null,c),n.a.createElement("p",null,"Your final score: ",o-1),p?n.a.createElement("div",{className:"submission-success"},n.a.createElement("p",null,"Score submitted successfully!")):n.a.createElement("form",{onSubmit:e=>{if(e.preventDefault(),d.trim())try{((e,t,a)=>{const r=q(),n={id:Date.now(),playerName:e,score:t,mode:a,date:(new Date).toISOString()};r.push(n),r.sort((e,t)=>t.score-e.score);const o=r.slice(0,100);localStorage.setItem("sortly_leaderboard",JSON.stringify(o))})(d,o-1,u),g(!0)}catch(t){v("Failed to submit score. Please try again.")}else v("Please enter your name")},className:"score-submission"},n.a.createElement("div",{className:"input-group"},n.a.createElement("label",{htmlFor:"playerName"},"Enter your name:"),n.a.createElement("input",{type:"text",id:"playerName",value:d,onChange:e=>b(e.target.value),placeholder:"Your name",maxLength:20})),y&&n.a.createElement("p",{className:"error"},y),n.a.createElement("button",{type:"submit",className:"button button-primary"},"Submit Score")),i&&l&&n.a.createElement("div",{className:"user-order"},n.a.createElement("h3",null,"Your order was:"),n.a.createElement("div",{className:"country-list"},i.map(e=>n.a.createElement(F,{key:e.id,country:e,isClickable:!0,highlight:e.id===l.id?"incorrect":"",mode:u})))),s&&l&&n.a.createElement("div",{className:"correct-order"},n.a.createElement("h3",null,"The correct order was:"),n.a.createElement("div",{className:"country-list"},s.map(e=>n.a.createElement(F,{key:e.id,country:e,isClickable:!0,highlight:e.id===l.id?"correct":"",mode:u})))),n.a.createElement("div",{className:"game-over-buttons"},n.a.createElement("button",{className:"button button-primary",onClick:()=>t("/game/"+u)},"Play Again"),n.a.createElement("button",{className:"button button-secondary",onClick:()=>t("/")},"Go to Home Page"),n.a.createElement("button",{className:"button button-secondary",onClick:()=>t("/leaderboard")},"View Leaderboard")))};const H=e=>(null===e||void 0===e?void 0:e.toDate)?e.toDate().toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):null;a(53);var B=function(){const[e,t]=Object(r.useState)([]),[a,o]=Object(r.useState)(null);return Object(r.useEffect)(()=>{(()=>{const e=q(a);t(e)})()},[a]),n.a.createElement("div",{className:"leaderboard-page"},n.a.createElement("h2",null,"Leaderboard"),n.a.createElement("div",{className:"mode-filters"},n.a.createElement("button",{className:"button "+(a?"button-secondary":"button-primary"),onClick:()=>o(null)},"All Modes"),n.a.createElement("button",{className:"button "+("population"===a?"button-primary":"button-secondary"),onClick:()=>o("population")},"Population"),n.a.createElement("button",{className:"button "+("area"===a?"button-primary":"button-secondary"),onClick:()=>o("area")},"Area")),n.a.createElement("div",{className:"leaderboard-table"},n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Rank"),n.a.createElement("th",null,"Player"),n.a.createElement("th",null,"Score"),n.a.createElement("th",null,"Mode"),n.a.createElement("th",null,"Date"))),n.a.createElement("tbody",null,e.map((e,t)=>n.a.createElement("tr",{key:e.id},n.a.createElement("td",null,t+1),n.a.createElement("td",null,e.playerName),n.a.createElement("td",null,e.score),n.a.createElement("td",null,e.mode.charAt(0).toUpperCase()+e.mode.slice(1)),n.a.createElement("td",null,H(e.date))))))))};const $={population:{sorting:{bronze:{id:"population_sorting_bronze",title:"Population Bronze Sorter",description:"Correctly sort 3 countries by population",icon:"\ud83e\udd49",requirement:3},silver:{id:"population_sorting_silver",title:"Population Silver Sorter",description:"Correctly sort 7 countries by population",icon:"\ud83e\udd48",requirement:7},gold:{id:"population_sorting_gold",title:"Population Gold Sorter",description:"Correctly sort 12 countries by population",icon:"\ud83e\udd47",requirement:12},platinum:{id:"population_sorting_platinum",title:"Population Platinum Sorter",description:"Correctly sort 20 countries by population",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"population_games",title:"Population Game Master",description:"Complete 50 population sorting games",icon:"\ud83c\udfae",requirement:50}},area:{sorting:{bronze:{id:"area_sorting_bronze",title:"Area Bronze Sorter",description:"Correctly sort 3 countries by area",icon:"\ud83e\udd49",requirement:3},silver:{id:"area_sorting_silver",title:"Area Silver Sorter",description:"Correctly sort 7 countries by area",icon:"\ud83e\udd48",requirement:7},gold:{id:"area_sorting_gold",title:"Area Gold Sorter",description:"Correctly sort 12 countries by area",icon:"\ud83e\udd47",requirement:12},platinum:{id:"area_sorting_platinum",title:"Area Platinum Sorter",description:"Correctly sort 20 countries by area",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"area_games",title:"Area Game Master",description:"Complete 50 area sorting games",icon:"\ud83c\udfae",requirement:50}}},Y={async getUserAchievements(e){try{const t=await Object(v.d)(Object(v.c)(O,"achievements",e));return t.exists()?t.data():null}catch(t){throw console.error("Error getting user achievements:",t),t}},async updateUserAchievements(e,t){try{await Object(v.k)(Object(v.c)(O,"achievements",e),{...t,updatedAt:Object(v.j)()},{merge:!0})}catch(a){throw console.error("Error updating user achievements:",a),a}},async checkAndUpdateAchievements(e,t,a){try{var r,n;const o=await this.getUserAchievements(e)||{},c=$[t];let l=!1;Object.values(c.sorting).forEach(e=>{!o[e.id]&&a>=e.requirement&&(o[e.id]={unlocked:!0,unlockedAt:Object(v.j)()},l=!0)});const i=c.gameCount,s=((null===(r=o[i.id])||void 0===r?void 0:r.count)||0)+1;return s>=i.requirement&&!(null===(n=o[i.id])||void 0===n?void 0:n.unlocked)?(o[i.id]={unlocked:!0,unlockedAt:Object(v.j)(),count:s},l=!0):(o[i.id]={...o[i.id],count:s},l=!0),l&&await this.updateUserAchievements(e,o),o}catch(o){throw console.error("Error checking achievements:",o),o}},getAchievementDefinitions:()=>$};a(54);var J=e=>{let{avatarOptions:t,selectedAvatar:a,onSelect:r,onClose:o}=e;return n.a.createElement("div",{className:"avatar-selector"},n.a.createElement("div",{className:"avatar-grid"},t.map(e=>n.a.createElement("div",{key:e.id,className:"avatar-option "+(a===e.url?"selected":""),onClick:()=>r(e.url)},n.a.createElement("img",{src:e.url,alt:e.name}),n.a.createElement("span",null,e.name)))))};a(55);var W=e=>{let{profile:t,currentUser:a,avatarOptions:o,onSubmit:c}=e;const[l,i]=Object(r.useState)({nickname:(null===t||void 0===t?void 0:t.nickname)||"",country:(null===t||void 0===t?void 0:t.country)||"",avatarUrl:(null===t||void 0===t?void 0:t.avatarUrl)||o[0].url}),[s,m]=Object(r.useState)(!1),[u,d]=Object(r.useState)(!1),b=e=>{const{name:t,value:a}=e.target;i(e=>({...e,[t]:a})),d(!0)};return n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"avatar-container"},n.a.createElement("img",{src:l.avatarUrl,alt:"Profile",className:"profile-avatar",onClick:()=>m(!0)}),s&&n.a.createElement(J,{avatarOptions:o,selectedAvatar:l.avatarUrl,onSelect:e=>{i(t=>({...t,avatarUrl:e})),m(!1),d(!0)},onClose:()=>m(!1)})),n.a.createElement("div",{className:"profile-info"},n.a.createElement("form",{onSubmit:async e=>{e.preventDefault();try{await c(l),d(!1)}catch(t){console.error("Error saving profile:",t)}},className:"profile-form"},n.a.createElement("div",{className:"form-group"},n.a.createElement("input",{type:"text",name:"nickname",value:l.nickname,onChange:b,placeholder:"Set your nickname",className:"inline-input"})),n.a.createElement("div",{className:"form-group"},n.a.createElement("input",{type:"text",name:"country",value:l.country,onChange:b,placeholder:"Set your country",className:"inline-input"})),n.a.createElement("div",{className:"email-display"},a.email),u&&n.a.createElement("button",{type:"submit",className:"save-button"},"Save Changes"))))};a(56);var K=e=>{let{achievement:t,isUnlocked:a,unlockDate:r}=e;return n.a.createElement("div",{className:"achievement-card "+(a?"unlocked":"locked")},n.a.createElement("div",{className:"achievement-content"},n.a.createElement("div",{className:"achievement-icon"},t.icon),n.a.createElement("div",{className:"achievement-info"},n.a.createElement("h3",null,t.title),n.a.createElement("p",null,t.description),a&&r&&n.a.createElement("div",{className:"achievement-date"},"Unlocked: ",H(r)))),n.a.createElement("div",{className:"achievement-status"},a?"\u2713":"\ud83d\udd12"))};a(57);var Z=e=>{let{achievementDefinitions:t,achievements:a}=e;const r=(e=>{const t=[];return Object.entries(e).forEach(e=>{let[a,r]=e;Object.entries(r.sorting).forEach(e=>{let[r,n]=e;t.push({...n,category:a,type:"sorting"})}),r.gameCount&&t.push({...r.gameCount,category:a,type:"gameCount"})}),t})(t);return n.a.createElement("div",{className:"achievements-section"},n.a.createElement("h2",null,"Achievements"),n.a.createElement("div",{className:"achievements-grid"},r.map(e=>{var t,r,o;return n.a.createElement(K,{key:e.id,achievement:e,isUnlocked:null!==(t=null===a||void 0===a||null===(r=a[e.id])||void 0===r?void 0:r.unlocked)&&void 0!==t&&t,unlockDate:null===a||void 0===a||null===(o=a[e.id])||void 0===o?void 0:o.unlockedAt})})))};a(58);var V=e=>{var t,a;let{game:r,index:o}=e;return n.a.createElement("div",{className:"game-history-item"},n.a.createElement("div",{className:"game-rank"},"#",o+1),n.a.createElement("div",{className:"game-score"},"Score: ",r.score),n.a.createElement("div",{className:"game-mode"},r.category.charAt(0).toUpperCase()+r.category.slice(1)," Mode"),n.a.createElement("div",{className:"game-date"},(null===(t=r.timestamp)||void 0===t?void 0:t.toDate)?H(r.timestamp):"Date unavailable"),n.a.createElement("div",{className:"game-countries"},null===(a=r.countries)||void 0===a?void 0:a.map((e,t)=>n.a.createElement("div",{key:t,className:"country-item"},n.a.createElement("img",{src:e.flagUrl,alt:e.name,className:"country-flag"}),n.a.createElement("span",null,e.name)))))};a(59);var X=e=>{let{gameHistory:t}=e;const a=Object(r.useMemo)(()=>{if(!t||0===Object.keys(t).length)return[];return Object.entries(t).flatMap(e=>{let[t,a]=e;return a.map(e=>({...e,category:t}))}).filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)).sort((e,t)=>t.score-e.score).slice(0,5)},[t]);return t?0===Object.keys(t).length?n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("p",null,"No games played yet. Start playing to see your best games here!")):n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("div",{className:"game-history-list"},a.map((e,t)=>n.a.createElement(V,{key:e.id,game:e,index:t})))):n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("p",null,"Loading game history..."))};a(60);var Q=()=>{const{currentUser:e}=N(),t=Object(m.o)(),[a,o]=Object(r.useState)(null),[c,l]=Object(r.useState)(null),[i,s]=Object(r.useState)(null),[u,d]=Object(r.useState)(!0),[b,p]=Object(r.useState)(""),[g,y]=Object(r.useState)(!1),[v,E]=Object(r.useState)(!1),[h,f]=Object(r.useState)({nickname:"",country:"",avatarUrl:""}),O=S.getAvatarOptions(),j=Y.getAchievementDefinitions(),w=null===e||void 0===e?void 0:e.uid,C=Object(r.useCallback)(async()=>{if(w)try{const[e,t,a]=await Promise.all([k.getUserProfile(w),Y.getUserAchievements(w),M.getAllTopGames(w)]);e&&(o(e),f({nickname:e.nickname||"",country:e.country||"",avatarUrl:e.avatarUrl||O[0].url})),l(t),s(a)}catch(b){p("Failed to load profile: "+b.message)}finally{d(!1)}},[w,O]);Object(r.useEffect)(()=>{e&&C()},[e,C]);return e?u?n.a.createElement("div",{className:"profile-page"},"Loading..."):n.a.createElement("div",{className:"profile-page"},n.a.createElement("div",{className:"profile-content"},n.a.createElement(W,{profile:a,currentUser:e,editing:g,formData:h,avatarOptions:O,showAvatarSelector:v,onEdit:()=>y(!0),onAvatarSelect:e=>{f(t=>({...t,avatarUrl:e})),E(!1)},onAvatarSelectorToggle:()=>E(!v),onSubmit:async t=>{t.preventDefault();try{p(""),await k.updateUserProfile(e.uid,h),o(e=>({...e,...h})),y(!1)}catch(b){p("Failed to update profile: "+b.message)}},onChange:e=>{const{name:t,value:a}=e.target;f(e=>({...e,[t]:a}))},onCancel:()=>y(!1)}),b&&n.a.createElement("div",{className:"error-message"},b),n.a.createElement(Z,{achievementDefinitions:j,achievements:c}),n.a.createElement(X,{gameHistory:i}))):(t("/"),null)};const ee=new class{constructor(){this.lobbiesRef=Object(E.e)(j,"lobbies")}async createLobby(e,t){const a=Object(E.e)(j,"lobbies/"+e);return await Object(E.g)(a,{players:[t],status:"waiting",createdAt:Date.now(),lastUpdated:Date.now()}),e}async joinLobby(e,t){const a=Object(E.e)(j,"lobbies/"+e),r=(await Object(E.a)(a)).val();if(!r)throw new Error("Lobby not found");{const e=r.players||[];await Object(E.h)(a,{players:[...e,t],lastUpdated:Date.now()})}}async leaveLobby(e,t){const a=Object(E.e)(j,"lobbies/"+e),r=(await Object(E.a)(a)).val();if(r){const e=(r.players||[]).filter(e=>e.id!==t);0===e.length?await Object(E.f)(a):await Object(E.h)(a,{players:e,lastUpdated:Date.now()})}}subscribeToLobby(e,t){const a=Object(E.e)(j,"lobbies/"+e);return Object(E.d)(a,e=>{const a=e.val();t(a||null)}),()=>Object(E.c)(a)}async startGame(e){const t=Object(E.e)(j,"lobbies/"+e);await Object(E.h)(t,{status:"playing",startedAt:Date.now(),lastUpdated:Date.now()})}async endGame(e){const t=Object(E.e)(j,"lobbies/"+e);await Object(E.h)(t,{status:"completed",endedAt:Date.now(),lastUpdated:Date.now()})}async cleanupLobby(e){const t=Object(E.e)(j,"lobbies/"+e);await Object(E.f)(t)}};a(61);var te=function(){const{currentUser:e}=N(),[t,a]=Object(r.useState)(""),[o,c]=Object(r.useState)([]),[i,s]=Object(r.useState)(!1),[u,d]=Object(r.useState)(""),[b,p]=Object(r.useState)(""),g=Object(m.o)(),[y]=Object(l.c)(),v=Object(r.useRef)(""),E=Object(r.useRef)(null);return Object(r.useEffect)(()=>{let t=null;return(async()=>{try{if(!e)return d("Please log in to join or create a lobby"),void setTimeout(()=>g("/"),2e3);let r="";try{const t=await k.getUserProfile(e.uid);(null===t||void 0===t?void 0:t.nickname)&&(r=t.nickname)}catch(u){console.error("Error fetching user profile:",u)}const n=y.get("lobby");if(n){v.current=n,a(n),s(!1),r||(r="Player 2"),E.current={id:e.uid,name:r,email:e.email};try{await ee.joinLobby(n,E.current)}catch(u){return console.error("Error joining lobby:",u),d(u.message||"Failed to join lobby"),void setTimeout(()=>g("/"),2e3)}}else{const t=Math.random().toString(36).substring(2,8).toUpperCase();v.current=t,a(t),s(!0),r||(r="Player 1"),E.current={id:e.uid,name:r,email:e.email};try{await ee.createLobby(t,E.current)}catch(u){return console.error("Error creating lobby:",u),d(u.message||"Failed to create lobby"),void setTimeout(()=>g("/"),2e3)}}t=ee.subscribeToLobby(v.current,e=>{if(e){const t=e.players||[];c(t),"playing"===e.status&&g("/game/population/cooperation/play",{state:{lobbyId:v.current,players:t}})}else d("Lobby not found or has been closed"),setTimeout(()=>g("/"),2e3)})}catch(u){console.error("Error initializing lobby:",u),d("Failed to initialize lobby")}})(),()=>{t&&t(),v.current&&E.current&&ee.leaveLobby(v.current,E.current.id)}},[y,e,g]),n.a.createElement("div",{className:"game-lobby"},n.a.createElement("h2",null,"Game Lobby"),n.a.createElement("div",{className:"lobby-info"},n.a.createElement("p",null,"Lobby ID: ",n.a.createElement("strong",null,t)),i&&n.a.createElement("button",{className:"button button-secondary copy-button "+(b?"copied":""),onClick:async()=>{const e=`${window.location.origin}/#/game/population/cooperation?lobby=${encodeURIComponent(v.current)}`;try{await navigator.clipboard.writeText(e),p("Copied!"),setTimeout(()=>{p("")},2e3)}catch(t){const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select();try{document.execCommand("copy"),p("Copied!"),setTimeout(()=>{p("")},2e3)}catch(t){p("Failed to copy"),console.error("Failed to copy text: ",t)}document.body.removeChild(a)}}},b||"Copy Invite Link")),n.a.createElement("div",{className:"players-list"},n.a.createElement("h3",null,"Players in Lobby:"),n.a.createElement("ul",null,o.map(e=>{var t;return n.a.createElement("li",{key:e.id,className:e.id===(null===(t=E.current)||void 0===t?void 0:t.id)?"current-player":""},e.name)}))),u&&n.a.createElement("p",{className:"error"},u),n.a.createElement("div",{className:"lobby-actions"},i&&n.a.createElement("button",{className:"button button-primary",onClick:async()=>{if(i)if(o.length<2)d("Waiting for another player to join...");else try{d(""),await T.initializeGameState(v.current,o),await ee.startGame(v.current)}catch(u){console.error("Error starting game:",u),d(u.message||"Failed to start game")}}},"Start Game"),n.a.createElement("button",{className:"button button-secondary",onClick:()=>g("/")},"Cancel")))};const ae={async addScore(e,t,a,r){try{return(await Object(v.a)(Object(v.b)(O,"scores"),{userId:e,username:t,score:a,gameMode:r,timestamp:Object(v.j)()})).id}catch(n){throw console.error("Error adding score:",n),n}},async getGlobalLeaderboard(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;try{const t=Object(v.i)(Object(v.b)(O,"scores"),Object(v.h)("score","desc"),e(e));return(await Object(v.e)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){throw console.error("Error getting leaderboard:",t),t}},async getUserBestScores(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{const a=Object(v.i)(Object(v.b)(O,"scores"),Object(v.m)("userId","==",e),Object(v.h)("score","desc"),t(t));return(await Object(v.e)(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(a){throw console.error("Error getting user scores:",a),a}}};function re(){const{currentUser:e,login:t,signup:a,logout:o}=N(),[c,l]=Object(r.useState)(""),[i,s]=Object(r.useState)(""),[m,u]=Object(r.useState)(""),[d,b]=Object(r.useState)(!1),[p,g]=Object(r.useState)(null);return n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement("h2",null,"Firebase Test"),e?n.a.createElement("div",null,n.a.createElement("p",null,"Logged in as: ",e.email),n.a.createElement("button",{onClick:async function(){try{u(""),b(!0),await o()}catch(m){u("Failed to log out: "+m.message)}b(!1)},disabled:d},"Log Out"),n.a.createElement("button",{onClick:async function(){if(e)try{await ae.addScore(e.uid,e.email,100,"test"),g("Score added successfully!")}catch(m){g("Failed to add score: "+m.message)}},style:{marginLeft:"10px"}},"Add Test Score"),p&&n.a.createElement("p",null,p)):n.a.createElement("div",null,n.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{u(""),b(!0),await a(c,i)}catch(m){u("Failed to create an account: "+m.message)}b(!1)}},n.a.createElement("input",{type:"email",value:c,onChange:e=>l(e.target.value),placeholder:"Email",required:!0}),n.a.createElement("input",{type:"password",value:i,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),n.a.createElement("button",{type:"submit",disabled:d},"Sign Up")),n.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{u(""),b(!0),await t(c,i)}catch(m){u("Failed to log in: "+m.message)}b(!1)},style:{marginTop:"10px"}},n.a.createElement("button",{type:"submit",disabled:d},"Log In"))),m&&n.a.createElement("p",{style:{color:"red"}},m))}a(62);var ne=function(){const e=Object(m.m)();return Object(r.useEffect)(()=>{d.a.initialize("G-9679TPXEBR")},[]),Object(r.useEffect)(()=>{d.a.send({hitType:"pageview",page:e.pathname})},[e.pathname]),n.a.createElement(C,null,n.a.createElement("div",{className:"App"},n.a.createElement(P,null),n.a.createElement("div",{className:"content"},n.a.createElement(m.c,null,n.a.createElement(m.a,{path:"/",element:n.a.createElement(I,null)}),n.a.createElement(m.a,{path:"/game/population",element:n.a.createElement(_,null)}),n.a.createElement(m.a,{path:"/game/population/cooperation",element:n.a.createElement(te,null)}),n.a.createElement(m.a,{path:"/game/population/cooperation/play",element:n.a.createElement(_,null)}),n.a.createElement(m.a,{path:"/game/area",element:n.a.createElement(_,null)}),n.a.createElement(m.a,{path:"/gameover",element:n.a.createElement(R,null)}),n.a.createElement(m.a,{path:"/leaderboard",element:n.a.createElement(B,null)}),n.a.createElement(m.a,{path:"/profile",element:n.a.createElement(Q,null)}),n.a.createElement(m.a,{path:"/test",element:n.a.createElement(re,null)}))),n.a.createElement(A,null)))};a(63);c.a.createRoot(document.getElementById("root")).render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(l.a,null,n.a.createElement(i.a,{backend:s.a},n.a.createElement(ne,null)))))}],[[31,1,2]]]);
//# sourceMappingURL=main.f99468a7.chunk.js.map