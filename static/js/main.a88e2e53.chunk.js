(this["webpackJsonpsortly-de"]=this["webpackJsonpsortly-de"]||[]).push([[0],Array(18).concat([function(e,t,a){},,function(e,t,a){e.exports=a.p+"static/media/logo.3de73253.png"},,,,,,function(e,t,a){},function(e,t,a){},,,,,,function(e,t,a){e.exports=a.p+"static/media/population.b123bcc2.jpg"},function(e,t,a){e.exports=a.p+"static/media/area.1a41ffef.jpg"},function(e,t,a){e.exports=a.p+"static/media/gini.04c4aefc.jpg"},,,,,function(e,t,a){e.exports=a(74)},,,,,,,,,,,,function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(28),l=a.n(o),i=a(10),c=a(78),s=a(38),m=a(3),d=a(19),u=a(17),g=a.n(u),p=(a(52),a(20)),y=a.n(p),b=a(15),v=a(32),f=a(6),h=a(4);const E=Object(v.a)({apiKey:"AIzaSyAOZkZ8FGkHv6J4xD-yckuKOasuO4zEF2c",authDomain:"sortly-1b701.firebaseapp.com",projectId:"sortly-1b701",storageBucket:"sortly-1b701.firebasestorage.app",messagingSenderId:"37869262835",appId:"1:37869262835:web:9d463c1b217727d88e6486",databaseURL:"https://sortly-1b701-default-rtdb.europe-west1.firebasedatabase.app"}),w=Object(b.b)(E),C=Object(f.f)(E),O=Object(h.b)(E);const j=Object(r.createContext)();function N(){return Object(r.useContext)(j)}function S(e){let{children:t}=e;const[a,o]=Object(r.useState)(null),[l,i]=Object(r.useState)(!0);Object(r.useEffect)(()=>Object(b.c)(w,e=>{o(e),i(!1)}),[]);const c={currentUser:a,signup:function(e,t){return Object(b.a)(w,e,t)},login:function(e,t){return Object(b.d)(w,e,t)},logout:function(){return Object(b.e)(w)}};return n.a.createElement(j.Provider,{value:c},!l&&t)}const k={getAvatarOptions:()=>[{id:"default",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=default",name:"Default"},{id:"happy",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=happy",name:"Happy"},{id:"cool",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=cool",name:"Cool"},{id:"smart",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=smart",name:"Smart"},{id:"friendly",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=friendly",name:"Friendly"},{id:"adventurous",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=adventurous",name:"Adventurous"},{id:"creative",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=creative",name:"Creative"},{id:"mysterious",url:"https://api.dicebear.com/7.x/avataaars/svg?seed=mysterious",name:"Mysterious"}]},G={async getUserProfile(e){try{const t=await Object(f.d)(Object(f.c)(C,"users",e));if(t.exists())return t.data();const a={nickname:"",country:"",avatarUrl:k.getAvatarOptions()[0].url,createdAt:new Date};return await this.updateUserProfile(e,a),a}catch(t){throw console.error("Error getting user profile:",t),t}},async updateUserProfile(e,t){try{const a=Object(f.c)(C,"users",e);await Object(f.k)(a,{...t,updatedAt:new Date},{merge:!0})}catch(a){throw console.error("Error updating user profile:",a),a}},async updateProfileField(e,t,a){try{const r=Object(f.c)(C,"users",e);await Object(f.l)(r,{[t]:a,updatedAt:new Date})}catch(r){throw console.error("Error updating profile field:",r),r}}};a(57);function P(){const{currentUser:e,login:t,signup:a,logout:o}=N(),[l,i]=Object(r.useState)(""),[c,s]=Object(r.useState)(""),[d,u]=Object(r.useState)(""),[g,p]=Object(r.useState)(!1),[y,b]=Object(r.useState)(!1),[v,f]=Object(r.useState)(null),h=Object(m.q)();return Object(r.useEffect)(()=>{(async()=>{if(e)try{const t=await G.getUserProfile(e.uid);f(t)}catch(d){console.error("Error loading user profile:",d)}})()},[e]),e?n.a.createElement("div",{className:"login-button"},n.a.createElement("div",{className:"user-profile-button",onClick:()=>h("/profile")},n.a.createElement("img",{src:(null===v||void 0===v?void 0:v.avatarUrl)||k.getAvatarOptions()[0].url,alt:"Profile",className:"header-avatar"}),n.a.createElement("span",{className:"user-name"},(null===v||void 0===v?void 0:v.nickname)||e.email)),n.a.createElement("button",{onClick:async function(){try{u(""),p(!0),await o(),h("/")}catch(d){u("Failed to log out: "+d.message)}p(!1)},disabled:g,className:"logout-button"},"Log Out")):n.a.createElement("div",{className:"login-button"},y?n.a.createElement("div",{className:"login-form"},n.a.createElement("input",{type:"email",value:l,onChange:e=>i(e.target.value),placeholder:"Email",required:!0}),n.a.createElement("input",{type:"password",value:c,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),n.a.createElement("div",{className:"login-buttons"},n.a.createElement("button",{onClick:async function(e){e.preventDefault();try{u(""),p(!0),await t(l,c),b(!1),h("/profile")}catch(d){u("Failed to log in: "+d.message)}p(!1)},disabled:g},"Login"),n.a.createElement("button",{onClick:async function(e){e.preventDefault();try{u(""),p(!0),await a(l,c),b(!1),h("/profile")}catch(d){u("Failed to create an account: "+d.message)}p(!1)},disabled:g},"Sign Up"),n.a.createElement("button",{onClick:()=>b(!1)},"Cancel")),d&&n.a.createElement("p",{style:{color:"red"}},d)):n.a.createElement("button",{onClick:()=>b(!0)},"Login / Sign Up"))}var U=function(){const[e,t]=Object(r.useState)(!1),a=Object(m.q)(),o=()=>{t(!1)},l=[{name:"classic",label:"Classic"},{name:"cooperation",label:"Cooperation"},{name:"battleroyale",label:"Battle Royale"}];return n.a.createElement("header",{className:"header"},n.a.createElement("div",{className:"header-container"},n.a.createElement(i.b,{to:"/",className:"header-logo",onClick:o},n.a.createElement("img",{src:y.a,alt:"Sortly Logo",className:"logo-image"}),n.a.createElement("span",{className:"site-name"},"Sortly")),n.a.createElement("button",{className:"menu-button",onClick:()=>{t(!e)}},"\u2630"),n.a.createElement("nav",{className:"header-nav "+(e?"active":"")},n.a.createElement(i.b,{to:"/",className:"nav-link",onClick:o},"Home"),["population","area","gini"].map(e=>{return n.a.createElement("div",{key:e,className:"nav-dropdown"},n.a.createElement("button",{className:"nav-link dropdown-toggle"},(t=e)&&t[0].toUpperCase()+t.slice(1)),n.a.createElement("div",{className:"dropdown-menu"},l.map(t=>n.a.createElement("button",{key:t.name,className:"dropdown-item",onClick:()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(e,{state:t}),o()}(`/game/${e}/${t.name}`,"classic"===t.name?{category:e}:{})},t.label))));var t}),n.a.createElement(i.b,{to:"/leaderboard",className:"nav-link",onClick:o},"Leaderboard"),n.a.createElement("div",{className:"nav-login"},n.a.createElement(P,null)))))};a(58);var I=function(){return n.a.createElement("footer",{className:"footer"},n.a.createElement("div",{className:"footer-container"},n.a.createElement("img",{src:y.a,alt:"Sortly Logo",className:"footer-logo"}),n.a.createElement("p",null,"\xa9 ",(new Date).getFullYear()," Sortly. All rights reserved.")))};var A=e=>{let{title:t,description:a,keywords:r,image:o,url:l,type:i,schema:c}=e;const s="Sortly - Interactive Country Sorting Game",m=a||"Challenge yourself with Sortly, the interactive sorting game. Sort countries by population or area and test your knowledge!",u=r||"sortly, sorting game, countries, population, area, game, interactive, geography",g=o||window.location.origin+"/logo512.png",p=l||window.location.href,y=i||"website";return n.a.createElement(d.a,null,n.a.createElement("title",null,t?t+" | Sortly":s),n.a.createElement("meta",{name:"description",content:m}),n.a.createElement("meta",{name:"keywords",content:u}),n.a.createElement("meta",{property:"og:type",content:y}),n.a.createElement("meta",{property:"og:url",content:p}),n.a.createElement("meta",{property:"og:title",content:t||s}),n.a.createElement("meta",{property:"og:description",content:m}),n.a.createElement("meta",{property:"og:image",content:g}),n.a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),n.a.createElement("meta",{name:"twitter:url",content:p}),n.a.createElement("meta",{name:"twitter:title",content:t||s}),n.a.createElement("meta",{name:"twitter:description",content:m}),n.a.createElement("meta",{name:"twitter:image",content:g}),c&&n.a.createElement("script",{type:"application/ld+json"},JSON.stringify(c)))},$=a(33),x=a.n($),D=a(34),L=a.n(D),F=a(35),R=a.n(F);a(59);const _=e=>e&&e[0].toUpperCase()+e.slice(1);var M=function(){const e=Object(m.q)(),t=[{name:"population",image:x.a},{name:"area",image:L.a},{name:"gini",image:R.a}],a=["classic","cooperation","battleroyale"];return n.a.createElement("div",{className:"homepage"},n.a.createElement(A,{title:"Sortly - Interactive Country Sorting Game",description:"Challenge yourself sort countries by population, area, or Gini index. Test your geography knowledge with Sortly!",keywords:"sortly, geography game, sort countries, population, area, gini index, educational game",schema:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Sortly",applicationCategory:"Game",operatingSystem:"Any",offers:{"@type":"Offer",price:"0",priceCurrency:"USD"},publisher:{"@type":"Organization",name:"Sortly",url:"https://sortly.de",logo:{"@type":"ImageObject",url:"https://sortly.de/logo512.png"}}}}),t.map(t=>n.a.createElement("div",{key:t.name,className:`section ${t.name}-section`,style:{backgroundImage:`url(${t.image})`,backgroundPosition:"center",backgroundSize:"cover",backgroundRepeat:"no-repeat"}},n.a.createElement("div",{className:"overlay"},n.a.createElement("h2",null,"Sort by ",_(t.name)),n.a.createElement("div",{className:`mode-buttons ${t.name}-modes`},a.map(a=>n.a.createElement("button",{key:a,className:"button button-primary",onClick:()=>((t,a)=>{const r="battleRoyale"===a?"Battle Royale":_(a),n=_(t),o=`/game/${t}/${a}`;console.log("Navigating to: "+o),g.a.event({category:"Game Navigation",action:`Clicked Play ${n} ${r}`,label:`${n} - ${r}`}),"classic"===a?e(o,{state:{category:t}}):"cooperation"===a||"battleroyale"===a?e(o):console.error("Unknown mode for navigation:",a)})(t.name,a)},"battleroyale"===a?"Battle Royale":_(a)," Mode")))))))};const q=e=>{if(!e||"object"!==typeof e||0===Object.keys(e).length)return null;const t=e[Object.keys(e).sort().pop()];return"number"===typeof t?t:null},T=async()=>{try{const e="https://restcountries.com/v3.1/all?fields=name,flags,population,area,gini,unMember",t=await fetch(e);if(!t.ok)throw new Error("HTTP error! status: "+t.status);const a=await t.json();if(!Array.isArray(a))throw new Error("Invalid data format received from API");const r=a.filter(e=>{var t,a;const r=q(e.gini);return e.unMember&&(null===(t=e.name)||void 0===t?void 0:t.common)&&(null===(a=e.flags)||void 0===a?void 0:a.svg)&&"number"===typeof e.population&&"number"===typeof e.area&&null!==r}).map((e,t)=>({id:e.name.common,name:e.name.common,flagUrl:e.flags.svg,population:e.population,area:e.area,gini:q(e.gini)}));return console.log(`Fetched ${r.length} countries with valid Pop, Area, and Gini.`),r.length<2&&console.warn("Fetched fewer than 2 countries with valid data including Gini."),r}catch(e){throw console.error("Error fetching countries:",e),new Error("Failed to fetch countries data. Please try again later.")}};a(26);var B=function(e){let{country:t,mode:a,statisticValue:o,isFlippable:l,isClickable:i,highlight:c,onClick:s,customClassName:m}=e;const[d,u]=Object(r.useState)(!1),g=c?"highlighted-"+c:"";return n.a.createElement("div",{className:`country-card ${l?"flippable":""} ${d?"flipped":""} ${i?"clickable":""} ${g} ${m||""}`,onClick:()=>{l?u(!d):i&&s&&s()}},n.a.createElement("div",{className:"card-inner"},n.a.createElement("div",{className:"card-face card-front "+g},n.a.createElement("img",{src:t.flagUrl,alt:"Flag of "+t.name,className:"country-flag"}),n.a.createElement("div",{className:"country-info"},n.a.createElement("h3",{className:"country-name"},t.name))),n.a.createElement("div",{className:"card-face card-back "+g},n.a.createElement("div",{className:"country-info"},n.a.createElement("h3",{className:"country-name"},t.name),n.a.createElement("p",{className:"country-detail"},(()=>{const e="number"!==typeof(t=o)?"":"gini"===a?t.toFixed(1):t.toLocaleString();var t;switch(a){case"population":return"Population: "+e;case"area":return`Area: ${e} km\xb2`;case"gini":return"Gini Index: "+e;default:return""}})())))))};const z=e=>"string"!==typeof e||0===e.length?e:e.charAt(0).toUpperCase()+e.slice(1);a(18);var H=function(e){let{category:t="population"}=e;const[a,o]=Object(r.useState)([]),[l,i]=Object(r.useState)([]),[c,s]=Object(r.useState)(null),[d,u]=Object(r.useState)(0),[g,p]=Object(r.useState)("loading"),[y,b]=Object(r.useState)(!0),[v,f]=Object(r.useState)(null),h=Object(m.q)();Object(r.useEffect)(()=>{(async()=>{b(!0),f(null);try{const e=(await T()).filter(e=>"undefined"!==typeof e[t]&&null!==e[t]);if(e.length<2)return f(`Not enough countries found with valid data for category: ${t}.`),p("ended"),void b(!1);const a=e.sort(()=>.5-Math.random()),r=[a[0],a[1]].sort((e,a)=>{var r,n;return(null!==(r=e[t])&&void 0!==r?r:0)-(null!==(n=a[t])&&void 0!==n?n:0)}),n=r[0],l=r[1];i([n]),s(l),o(a.slice(2).sort(()=>.5-Math.random())),u(1),p("placing")}catch(e){console.error(`Failed to load countries for category ${t}:`,e),f(e.message||`Failed to load game data for ${t}.`),p("ended")}finally{b(!1)}})()},[t]);const E=Object(r.useCallback)(()=>{if(a.length>0){const e=a[0];s(e),o(a.slice(1)),p("placing")}else p("ended"),h("/gameover",{state:{score:d,message:`Congratulations! You sorted all countries by ${"gini"===t?"Gini index":z(t)}!`,category:t,gameMode:"classic_"+t},replace:!0})},[a,d,t,h]),w=e=>{if(!c||"placing"!==g)return;const a=c,r=[...l];r.splice(e,0,a);let n=!0;var o,m,y,b;e>0&&(n=n&&(null!==(o=r[e-1][t])&&void 0!==o?o:0)<=(null!==(m=a[t])&&void 0!==m?m:0));e<r.length-1&&(n=n&&(null!==(y=a[t])&&void 0!==y?y:0)<=(null!==(b=r[e+1][t])&&void 0!==b?b:0));if(n)i(r),u(d+1),s(null),p("picking");else{const r=[...l],n=a,o=e,i=[...l];i.splice(e,0,n),p("ended"),h("/gameover",{state:{score:d,message:`Incorrect placement based on ${"gini"===t?"Gini index":z(t)}. Game Over!`,category:t,gameMode:"classic_"+t,finalSortedList:r,incorrectCountry:n,attemptedIndex:o,userOrder:i},replace:!0})}};return Object(r.useEffect)(()=>{"picking"===g&&E()},[g,E]),y?n.a.createElement("div",{className:"game-mode-loading"},"Loading Classic Game..."):v?n.a.createElement("div",{className:"game-mode-error"},"Error: ",v," ",n.a.createElement("button",{onClick:()=>window.location.reload()},"Retry")):n.a.createElement("div",{className:"game-mode classic-mode"},n.a.createElement("h2",null,"Classic Mode - Sort by ","gini"===t?"Gini Index":z(t)," (Lowest to Highest)"),n.a.createElement("p",null,"Score: ",d>0?d-1:0),n.a.createElement("div",{className:"sorted-countries-container"},n.a.createElement("div",{className:"sorted-countries"},c&&"placing"===g&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>w(0),"aria-label":"Place card at the beginning",title:`Place ${c.name} at the beginning`},"+"),l.map((e,a)=>n.a.createElement(n.a.Fragment,{key:"fragment-"+e.id},n.a.createElement(B,{country:e,mode:t,statisticValue:e[t],isFlippable:!0,isClickable:!1}),c&&"placing"===g&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>w(a+1),"aria-label":"Place card after "+e.name,title:`Place ${c.name} after ${e.name}`},"+"))),0===l.length&&c&&"placing"===g&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>w(0),"aria-label":"Place first card",title:`Place ${c.name} at the beginning`},"+"))),"placing"===g&&c&&n.a.createElement("div",{className:"current-country"},n.a.createElement("h3",null,"Place this Country:"),n.a.createElement("div",{className:"current-country-wrapper",title:c.name+" - place it in the list above"},n.a.createElement(B,{country:c,mode:t,statisticValue:c[t],isFlippable:!1,isClickable:!1}))))};const V={async initializeGameState(e,t){let a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"population";try{if(a=await T(),a.sort((e,t)=>{var a,n;return(null!==(a=e[r])&&void 0!==a?a:0)-(null!==(n=t[r])&&void 0!==n?n:0)}),!a||a.length<11)throw new Error(`Not enough valid countries fetched to start cooperation mode for category ${r}.`)}catch(s){throw console.error("Failed to fetch countries for initialization:",s),new Error(`Could not fetch country data for category ${r} to start the game.`)}const n=((e,t)=>{t>e.length&&(console.warn("Requested more elements than available"),t=e.length);return[...e].sort(()=>.5-Math.random()).slice(0,t)})(a,11),o=n[0],l=n.slice(1).sort((e,t)=>.5-Math.random()),i=Object(h.e)(O,"gameStates/"+e),c={lobbyId:e,category:r,currentPlayer:t[0].id,players:t,mode:"choosing",sortedCountries:[o],remainingCountries:l,currentCountry:null,score:1,status:"playing",createdAt:Date.now(),lastUpdated:Date.now()};await Object(h.g)(i,c),console.log(`Initialized ${r} cooperation game state for lobby`,e)},subscribeToGameState(e,t){const a=Object(h.e)(O,"gameStates/"+e),r=Object(h.d)(a,e=>{const a=e.val();t(a)},e=>{console.error("Error subscribing to game state:",e),t(null)});return()=>Object(h.c)(a,"value",r)},async updateGameState(e,t){const a=Object(h.e)(O,"gameStates/"+e);await Object(h.h)(a,{...t,lastUpdated:Date.now()})},async chooseCard(e,t,a){const r=Object(h.e)(O,"gameStates/"+e),n=(await Object(h.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("choosing"!==n.mode)throw new Error("Not in choosing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to choose");if(!n.remainingCountries||!n.remainingCountries.some(e=>e.id===a.id))throw console.error("Chosen country ID not found in remaining:",null===a||void 0===a?void 0:a.id,n.remainingCountries),new Error("Chosen country is not valid or not in the remaining inventory");await Object(h.h)(r,{currentCountry:a,mode:"placing",lastUpdated:Date.now()})},async placeCard(e,t,a){const r=Object(h.e)(O,"gameStates/"+e),n=(await Object(h.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("placing"!==n.mode)throw new Error("Not in placing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to place");if(!n.currentCountry)throw new Error("No country currently chosen for placement");if("number"!==typeof a||a<0||a>n.sortedCountries.length)throw console.error("Invalid placement index received:",a,"Current sorted length:",n.sortedCountries.length),new Error("Invalid placement index");const o=n.category||"population",l=[...n.sortedCountries];l.splice(a,0,n.currentCountry);if((e=>{if(!Array.isArray(e))return console.error("isCorrect received non-array:",e),!1;for(let t=0;t<e.length-1;t++)if(!e[t]||!e[t+1]||"undefined"===typeof e[t][o]||"undefined"===typeof e[t+1][o]||e[t][o]>e[t+1][o])return console.warn(`Incorrect order found at index ${t} for category ${o}:`,e[t][o],e[t+1][o]),!1;return!0})(l)){var i;const e=n.currentCountry.id;let a=n.remainingCountries||[];a=a.filter(t=>t.id!==e);let o=null===(i=n.players[0])||void 0===i?void 0:i.id;if(n.players.length>1){const e=n.players.findIndex(e=>e.id===t);o=n.players[(e+1)%n.players.length].id}const c={currentPlayer:o,sortedCountries:l,remainingCountries:a,currentCountry:null,mode:"choosing",score:n.score+1,lastUpdated:Date.now()};0===a.length&&(c.status="completed",c.result="win",c.mode="finished"),await Object(h.h)(r,c)}else console.log(`Incorrect placement by ${t}. Ending game.`),await this.endGame(e)},async endGame(e){const t=Object(h.e)(O,"gameStates/"+e),a=await Object(h.a)(t);a.exists()&&"playing"===a.val().status?(await Object(h.h)(t,{status:"completed",result:"lose",mode:"finished",currentCountry:null,lastUpdated:Date.now()}),console.log("Game ended with lose state for lobby:",e)):console.log("Game already completed or does not exist, skipping endGame call for lobby:",e)},async cleanupGameState(e){const t=Object(h.e)(O,"gameStates/"+e);await Object(h.g)(t,null)}},Y=e=>e&&e[0].toUpperCase()+e.slice(1);var W=function(e){var t,a;let{lobbyId:o,category:l="population"}=e;const{currentUser:i}=N(),[c,s]=Object(r.useState)([]),[d,u]=Object(r.useState)(null),[g,p]=Object(r.useState)([]),[y,b]=Object(r.useState)(0),[v,f]=Object(r.useState)("waiting"),[h,E]=Object(r.useState)(null),w=Object(m.q)(),C=(null===h||void 0===h?void 0:h.category)||l;Object(r.useEffect)(()=>{if(!o)return console.error("CooperationMode requires a lobbyId prop."),void w("/");const e=V.subscribeToGameState(o,e=>{if(e){E(e),b(void 0!==e.score?e.score:0),s(e.sortedCountries||[]),u(e.currentCountry||null),p(e.remainingCountries||[]),f(e.status||"waiting");const t=e.category||"population";if("completed"===e.status){let a="Game Over!",r=e.score||0;const n="gini"===t?"Gini index":Y(t);"win"===e.result?a=`Congratulations! You sorted all countries correctly by ${n}.`:"lose"===e.result&&(a=`Game Over! An incorrect move was made while sorting by ${n}.`),w("/gameover",{state:{score:r,message:a,category:t,gameMode:"cooperation_"+t},replace:!0})}}else console.error("Game state not found for lobby:",o),w("/")});return()=>e()},[o,w,i]);const O=async e=>{if(h&&i&&d&&h.currentPlayer===i.uid&&"placing"===h.mode)try{await V.placeCard(h.lobbyId,i.uid,e)}catch(t){console.error("Error placing card:",t)}};if(!h||"waiting"===v)return n.a.createElement("div",{className:"game-mode-loading"},"Loading Cooperation Game...");const j=h.currentPlayer===(null===i||void 0===i?void 0:i.uid),S=(null===(t=h.players)||void 0===t||null===(a=t.find(e=>e.id===h.currentPlayer))||void 0===a?void 0:a.name)||"Unknown",k="placing"===h.mode&&j&&d;return n.a.createElement("div",{className:"game-mode cooperation-mode"}," ",n.a.createElement("h2",null,"Cooperation Mode - Sort by ","gini"===C?"Gini Index":Y(C)),n.a.createElement("p",null,"Current Turn: ",S),n.a.createElement("p",null,"Score: ",y),n.a.createElement("div",{className:"sorted-countries-container"},n.a.createElement("h3",null,"Sorted Countries:"),n.a.createElement("div",{className:"sorted-countries"},k&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>O(0),"aria-label":"Place card at the beginning"},"+"),c.map((e,t)=>n.a.createElement(n.a.Fragment,{key:"sorted-fragment-"+e.id},n.a.createElement(B,{country:e,mode:C,statisticValue:e[C],isFlippable:!0,isClickable:!1}),k&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>O(t+1),"aria-label":"Place card after "+e.name},"+"))),0===c.length&&k&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>O(0),"aria-label":"Place first card"},"+"))),n.a.createElement("div",{className:"remaining-countries"},n.a.createElement("h3",null,"Remaining Countries to Sort: (",g.length,")"),n.a.createElement("div",{className:"remaining-countries-grid"},g.map(e=>{const t="placing"===h.mode&&d&&e.id===d.id;return n.a.createElement(B,{key:"remaining-"+e.id,country:e,mode:C,statisticValue:e[C],isFlippable:!1,isClickable:"choosing"===h.mode&&j,onClick:()=>"choosing"===h.mode&&j&&(async e=>{if(h&&i&&h.currentPlayer===i.uid&&"choosing"===h.mode)try{await V.chooseCard(h.lobbyId,i.uid,e)}catch(t){console.error("Error choosing card:",t)}})(e),customClassName:t?"selected-for-placing":""})}))),n.a.createElement("div",{className:"game-instructions"},"choosing"===h.mode&&(j?n.a.createElement("p",null,"Choose a country from the remaining countries to place next."):n.a.createElement("p",null,"Waiting for ",S," to choose a country...")),"placing"===h.mode&&(j?n.a.createElement("p",null,"Place ",null===d||void 0===d?void 0:d.name," in the correct position based on ","gini"===C?"Gini index":C,"."):n.a.createElement("p",null,"Waiting for ",S," to place ",null===d||void 0===d?void 0:d.name,"..."))))};const J={async initializeGameState(e,t){let a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"population";if(t.length<2||t.length>8)throw new Error("Battle Royale mode requires between 2 and 8 players.");try{if(a=await T(),a.sort((e,t)=>{var a,n;return(null!==(a=e[r])&&void 0!==a?a:0)-(null!==(n=t[r])&&void 0!==n?n:0)}),!a||a.length<26)throw new Error(`Not enough valid countries fetched to start Battle Royale mode for category ${r}. Need 26.`)}catch(m){throw console.error("Failed to fetch countries for initialization:",m),new Error(`Could not fetch country data for category ${r} to start the game.`)}const n=((e,t)=>{t>e.length&&(console.warn("Requested more elements than available"),t=e.length);return[...e].sort(()=>.5-Math.random()).slice(0,t)})(a,26),o=n[0],l=n.slice(1).sort((e,t)=>.5-Math.random()),i=t.map(e=>({...e,isActive:!0,score:0})),c=Object(h.e)(O,"battleRoyaleGameStates/"+e),s={lobbyId:e,category:r,gameType:"battleRoyale",currentPlayer:i[0].id,players:i,activePlayers:i.map(e=>e.id),mode:"choosing",sortedCountries:[o],remainingCountries:l,currentCountry:null,status:"playing",createdAt:Date.now(),lastUpdated:Date.now()};await Object(h.g)(c,s),console.log(`Initialized ${r} Battle Royale game state for lobby`,e,"at path battleRoyaleGameStates/"+e)},subscribeToGameState(e,t){const a=Object(h.e)(O,"battleRoyaleGameStates/"+e),r=Object(h.d)(a,e=>{const a=e.val();t(a)},e=>{console.error("Error subscribing to game state:",e),t(null)});return()=>Object(h.c)(a,"value",r)},async updateGameState(e,t){const a=Object(h.e)(O,"battleRoyaleGameStates/"+e);await Object(h.h)(a,{...t,lastUpdated:Date.now()})},async chooseCard(e,t,a){const r=Object(h.e)(O,"battleRoyaleGameStates/"+e),n=(await Object(h.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("choosing"!==n.mode)throw new Error("Not in choosing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to choose");const o=n.players.find(e=>e.id===t);if(!o||!o.isActive)throw new Error("You have been eliminated from the game.");if(!n.remainingCountries||!n.remainingCountries.some(e=>e.id===a.id))throw console.error("Chosen country ID not found in remaining:",null===a||void 0===a?void 0:a.id,n.remainingCountries),new Error("Chosen country is not valid or not in the remaining inventory");await Object(h.h)(r,{currentCountry:a,mode:"placing",lastUpdated:Date.now()})},_findNextActivePlayer(e,t){const a=e.filter(e=>e.isActive);if(0===a.length)return null;const r=a.findIndex(e=>e.id===t);return-1===r||r===a.length-1?a[0].id:a[r+1].id},async placeCard(e,t,a){const r=Object(h.e)(O,"battleRoyaleGameStates/"+e);let n=(await Object(h.a)(r)).val();if(!n||"playing"!==n.status)throw new Error("Game is not active or not found");if("placing"!==n.mode)throw new Error("Not in placing mode");if(n.currentPlayer!==t)throw new Error("Not your turn to place");if(!n.currentCountry)throw new Error("No country currently chosen for placement");const o=n.players.find(e=>e.id===t);if(!o||!o.isActive)throw new Error("You have been eliminated from the game.");if("number"!==typeof a||a<0||a>n.sortedCountries.length)throw console.error("Invalid placement index received:",a,"Current sorted length:",n.sortedCountries.length),new Error("Invalid placement index");const l=n.category||"population",i=[...n.sortedCountries];i.splice(a,0,n.currentCountry);let c={};const s=n.players,m=n.currentCountry.id;if((e=>{if(!Array.isArray(e))return!1;for(let t=0;t<e.length-1;t++)if(!e[t]||!e[t+1]||"undefined"===typeof e[t][l]||"undefined"===typeof e[t+1][l]||e[t][l]>e[t+1][l])return console.warn(`Incorrect order found at index ${t} for category ${l}:`,e[t][l],e[t+1][l]),!1;return!0})(i)){console.log(`Correct placement by ${t}.`);const e=(n.remainingCountries||[]).filter(e=>e.id!==m),a=s.findIndex(e=>e.id===t);-1!==a&&(s[a].score=(s[a].score||0)+1);c={players:s,currentPlayer:this._findNextActivePlayer(s,t),sortedCountries:i,remainingCountries:e,currentCountry:null,mode:"choosing",lastUpdated:Date.now()}}else{console.log(`Incorrect placement by ${t}. Eliminating player.`);const e=s.findIndex(e=>e.id===t);-1!==e&&(s[e].isActive=!1);const a=s.filter(e=>e.isActive),r=a.map(e=>e.id);if(a.length<=1)console.log("Battle Royale finished. Winner determined."),c={players:s,activePlayers:r,status:"completed",mode:"finished",result:1===a.length?a[0].id:"draw",winner:1===a.length?a[0]:null,currentCountry:null,lastUpdated:Date.now()};else{c={players:s,activePlayers:r,currentPlayer:this._findNextActivePlayer(s,t),currentCountry:null,remainingCountries:(n.remainingCountries||[]).filter(e=>e.id!==m),mode:"choosing",lastUpdated:Date.now()}}}await Object(h.h)(r,c)},async endGame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=Object(h.e)(O,"battleRoyaleGameStates/"+e),r=await Object(h.a)(a);if(r.exists()){const e=r.val();if("playing"===e.status){const r=e.players.find(e=>e.id===t);await Object(h.h)(a,{status:"completed",result:t||"ended",winner:r||null,mode:"finished",currentCountry:null,lastUpdated:Date.now()}),console.log("Battle Royale game ended. Winner: "+(t||"N/A"))}else console.log("Game already completed, skipping endGame call.")}else console.log("Game state not found, cannot end game for lobby:",e)},async cleanupGameState(e){const t=Object(h.e)(O,"battleRoyaleGameStates/"+e);await Object(h.g)(t,null),console.log("Cleaned up Battle Royale game state for lobby:",e)}};var K=function(e){var t,a,o;let{lobbyId:l,category:i="population"}=e;const{currentUser:c}=N(),[s,d]=Object(r.useState)([]),[u,g]=Object(r.useState)(null),[p,y]=Object(r.useState)([]),[b,v]=Object(r.useState)("waiting"),[f,h]=Object(r.useState)(null),E=Object(m.q)(),w=(null===f||void 0===f?void 0:f.category)||i;Object(r.useEffect)(()=>{if(!l)return console.error("BattleRoyaleMode requires a lobbyId prop."),void E("/");const e=J.subscribeToGameState(l,e=>{if(e){h(e),d(e.sortedCountries||[]),g(e.currentCountry||null),y(e.remainingCountries||[]),v(e.status||"waiting");const t=e.category||"population";if("completed"===e.status){let a="Battle Royale Over!",r="N/A",n=0;e.winner?(r=e.winner.name,n=e.winner.score||0,a=r+" is the last one standing!"):"draw"===e.result&&(a="The Battle Royale ended in a draw!"),E("/gameover",{state:{score:n,message:a,winnerName:r,category:t,gameMode:"battleRoyale_"+t,finalPlayersState:e.players},replace:!0})}}else console.error("Game state not found for lobby:",l),E("/")});return()=>e()},[l,E]);const C=async e=>{if(!f||!c||!u)return;if(f.currentPlayer!==c.uid)return;if("placing"!==f.mode)return;const t=f.players.find(e=>e.id===c.uid);if(t&&t.isActive)try{await J.placeCard(f.lobbyId,c.uid,e)}catch(a){console.error("Error placing card:",a)}else console.log("Cannot place card, you are eliminated.")};if(!f||"waiting"===b)return n.a.createElement("div",{className:"game-mode-loading"},"Loading Battle Royale...");const O=null===(t=f.players)||void 0===t?void 0:t.find(e=>e.id===(null===c||void 0===c?void 0:c.uid)),j=f.currentPlayer===(null===c||void 0===c?void 0:c.uid)&&(null===O||void 0===O?void 0:O.isActive),S=null===O||void 0===O?void 0:O.isActive,k=null===(a=f.players)||void 0===a?void 0:a.find(e=>e.id===f.currentPlayer),G=(null===k||void 0===k?void 0:k.name)||"Unknown",P="choosing"===f.mode&&j,U="placing"===f.mode&&j&&u;return n.a.createElement("div",{className:"game-mode battle-royale-mode "+(S?"":"eliminated")}," ",n.a.createElement("h2",null,"Battle Royale - ","gini"===w?"Gini Index":(I=w)&&I[0].toUpperCase()+I.slice(1)),n.a.createElement("div",{className:"player-status-container"},n.a.createElement("h3",null,"Players:"),n.a.createElement("ul",null,null===(o=f.players)||void 0===o?void 0:o.map(e=>n.a.createElement("li",{key:e.id,className:`${e.isActive?"":"eliminated-player"} ${e.id===f.currentPlayer?"current-turn":""}`},e.name," ",e.id===(null===c||void 0===c?void 0:c.uid)?"(You)":""," - Score: ",e.score||0," ",e.isActive?"":"(Eliminated)")))),!S&&n.a.createElement("p",{className:"eliminated-message"},"You have been eliminated!"),n.a.createElement("p",null,"Current Turn: ",G," ",f.currentPlayer===(null===c||void 0===c?void 0:c.uid)?"(Your Turn)":""),n.a.createElement("div",{className:"sorted-countries-container"},n.a.createElement("h3",null,"Sorted Countries: (",s.length,")"),n.a.createElement("div",{className:"sorted-countries"},U&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>C(0),"aria-label":"Place card at the beginning",disabled:!S},"+"),s.map((e,t)=>n.a.createElement(n.a.Fragment,{key:"sorted-fragment-"+e.id},n.a.createElement(B,{country:e,mode:w,statisticValue:e[w],isFlippable:!0,isClickable:!1}),U&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>C(t+1),"aria-label":"Place card after "+e.name,disabled:!S},"+"))),0===s.length&&U&&n.a.createElement("button",{className:"place-button plus-button",onClick:()=>C(0),"aria-label":"Place first card",disabled:!S},"+"))),n.a.createElement("div",{className:"remaining-countries"},n.a.createElement("h3",null,"Remaining Countries: (",p.length,")"),n.a.createElement("div",{className:"remaining-countries-grid"},p.map(e=>{const t="placing"===f.mode&&u&&e.id===u.id;return n.a.createElement(B,{key:"remaining-"+e.id,country:e,mode:w,statisticValue:e[w],isFlippable:!1,isClickable:P,onClick:()=>P&&(async e=>{if(!f||!c)return;if(f.currentPlayer!==c.uid)return;if("choosing"!==f.mode)return;const t=f.players.find(e=>e.id===c.uid);if(t&&t.isActive)try{await J.chooseCard(f.lobbyId,c.uid,e)}catch(a){console.error("Error choosing card:",a)}else console.log("Cannot choose card, you are eliminated.")})(e),customClassName:`${t?"selected-for-placing":""} ${S?"":"disabled-card"}`})}))),n.a.createElement("div",{className:"game-instructions"},S&&"choosing"===f.mode&&(j?n.a.createElement("p",null,"Choose a country to place next."):n.a.createElement("p",null,"Waiting for ",G," to choose...")),S&&"placing"===f.mode&&(j?n.a.createElement("p",null,"Place ",null===u||void 0===u?void 0:u.name," in the correct position based on ","gini"===w?"Gini index":w,"."):n.a.createElement("p",null,"Waiting for ",G," to place ",null===u||void 0===u?void 0:u.name,"...")),!S&&"completed"!==b&&n.a.createElement("p",null,"Waiting for the remaining players...")));var I};const Z=["population","area","gini"],X=["classic","cooperation","battleroyale"];var Q=function(){var e;const{category:t,mode:a}=Object(m.s)(),r=Object(m.n)(),o=Z.includes(null===t||void 0===t?void 0:t.toLowerCase()),l=X.includes(null===a||void 0===a?void 0:a.toLowerCase());if(!o||!l)return console.error(`Invalid category (${t}) or mode (${a}) accessed.`),n.a.createElement(m.a,{to:"/",replace:!0});const i=null===(e=r.state)||void 0===e?void 0:e.lobbyId;return"cooperation"!==a&&"battleroyale"!==a||i?n.a.createElement("div",{className:"game-page-container"},n.a.createElement(A,{title:`Sort by ${t.charAt(0).toUpperCase()+t.slice(1)} (${a})`,description:`Play Sortly: Sort countries by ${t} in ${a} mode.`}),(()=>{switch(a.toLowerCase()){case"classic":return n.a.createElement(H,{category:t});case"cooperation":return n.a.createElement(W,{category:t,lobbyId:i});case"battleroyale":return n.a.createElement(K,{category:t,lobbyId:i});default:return console.error("Reached default case in renderGameMode - should not happen!"),n.a.createElement(m.a,{to:"/",replace:!0})}})()):(console.error(a+" mode requires a lobbyId in location state."),n.a.createElement(m.a,{to:"/",replace:!0,state:{error:"Lobby ID missing for multiplayer game."}}))};const ee=e=>{if(!e||"string"!==typeof e)return console.error("Invalid category provided to getLeaderboard:",e),[];const t="sortly_leaderboard_"+e.toLowerCase();try{const e=localStorage.getItem(t);return JSON.parse(e||"[]")}catch(a){return console.error(`Error reading leaderboard from localStorage for ${e}:`,a),[]}},te=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if(!e||"string"!==typeof e)return console.error("Invalid category provided to getTopScores:",e),[];const a=ee(e);return a.slice(0,t)},ae=["population","area","gini"],re={async getTopGames(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"classic",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;try{console.log(`Fetching top games for: userId=${e}, category=${t}, mode=${a}, limit=${r}`);const n=Object(f.b)(C,"gameHistory"),o=Object(f.i)(n,Object(f.m)("userId","==",e),Object(f.m)("category","==",t),Object(f.m)("mode","==",a),Object(f.h)("score","desc"),Object(f.g)(r)),l=(await Object(f.e)(o)).docs.map(e=>({id:e.id,...e.data()}));return console.log("Fetched games:",l),l}catch(n){console.error("Error fetching top games, attempting fallback:",n);try{const n=Object(f.i)(Object(f.b)(C,"gameHistory"),Object(f.m)("userId","==",e),Object(f.m)("category","==",t),Object(f.m)("mode","==",a)),o=await Object(f.e)(n),l=o.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.score-e.score).slice(0,r);return console.log("Fetched games (fallback):",l),l}catch(o){throw console.error("Fallback fetch also failed:",o),o}}},async getAllTopGames(e){try{const t={};return await Promise.all(ae.map(async a=>{t[a]=await this.getTopGames(e,a)})),t}catch(t){return console.error("Error fetching all top games:",t),{}}},async getGameDetails(e){try{const t=Object(f.c)(C,"gameHistory",e),a=await Object(f.d)(t);return a.exists()?(console.log("Fetched game details for ID:",e,a.data()),{id:a.id,...a.data()}):(console.log("No such game document!",e),null)}catch(t){throw console.error("Error getting game details:",t),t}},async saveGame(e,t,a,r,n,o,l){try{const i=n?n.map(e=>{let{id:a,name:r,flagUrl:n,...o}=e;return{id:a,name:r,flagUrl:n,value:o[t]}}):null,c="classic"===a&&o?o.map(e=>{let{id:a,name:r,flagUrl:n,...o}=e;return{id:a,name:r,flagUrl:n,value:o[t]}}):null,s="classic"===a&&l?{id:l.id,name:l.name,flagUrl:l.flagUrl,value:l[t]}:null,m={userId:e,category:t,mode:a,score:r,userAttemptList:i,correctlySortedList:c,incorrectCountry:s,timestamp:Object(f.j)()};Object.keys(m).forEach(e=>{null===m[e]&&delete m[e]});const d=await Object(f.a)(Object(f.b)(C,"gameHistory"),m);return console.log("Game history saved with ID:",d.id,"Data:",m),d.id}catch(i){throw console.error("Error saving game history:",i),i}}};a(60),a(27);var ne=function(){const e=Object(m.n)(),t=Object(m.q)(),{currentUser:a}=N(),{score:o=0,message:l="Game Over!",gameMode:i="unknown",incorrectCountry:c,userOrder:s,finalSortedList:d,winnerName:u,finalPlayersState:g}=e.state||{},{mode:p,category:y}=(e=>{if(!e||"string"!==typeof e)return{mode:"unknown",category:"unknown"};const t=e.split("_");if(2===t.length){return{mode:t[0].toLowerCase(),category:t[1].toLowerCase()}}return 1===t.length?{mode:t[0].toLowerCase(),category:"unknown"}:{mode:"unknown",category:"unknown"}})(i),[b,v]=Object(r.useState)(""),[f,h]=Object(r.useState)(!1),[E,w]=Object(r.useState)(""),[C,O]=Object(r.useState)(null),j=Object(r.useRef)(!1);return Object(r.useEffect)(()=>{(async()=>{if(a)try{const e=await G.getUserProfile(a.uid);(null===e||void 0===e?void 0:e.nickname)&&v(e.nickname)}catch(e){console.error("Error fetching user profile:",e)}})()},[a]),Object(r.useEffect)(()=>{(async()=>{if(j.current||"unknown"===y||"unknown"===p)return j.current&&console.log("Save skipped: Already attempted."),void("unknown"!==y&&"unknown"!==p||console.log("Save skipped: Unknown category or mode."));if(j.current=!0,!a)return void console.log("Firestore save skipped: No user logged in.");console.log("Attempting to save game history...");let e=0,t=null,r=null,n=null;if("classic"===p||"cooperation"===p)e=o>0?o-1:0,s&&(t=s.map(e=>({id:e.id,name:e.name,flagUrl:e.flagUrl,[y]:e[y]}))),"classic"===p&&(d&&(r=d.map(e=>({id:e.id,name:e.name,flagUrl:e.flagUrl,[y]:e[y]}))),c&&(n={id:c.id,name:c.name,flagUrl:c.flagUrl,[y]:c[y]}));else{if("battleroyale"!==p)return void console.log("Save skipped: Unrecognized game mode:",p);e=o,g&&(t=g.map(e=>({name:e.name,score:e.score,isActive:e.isActive})))}if(e>0||t&&t.length>0)try{console.log("Calling gameHistoryService.saveGame with:",{userId:a.uid,category:y,mode:p,historyScore:e});const o=await re.saveGame(a.uid,y,p,e,t,r,n);O(o),console.log("Game history saved successfully with ID:",o)}catch(l){console.error("Error saving game history:",l),w("Failed to save game details. Score submission may not link correctly.")}else console.log("Skipping game history save: Score is zero and no other data to save.")})()},[a,p,y,o,s,d,c,g]),n.a.createElement("div",{className:`game-over-page game-over-${p}-${y}`}," ",n.a.createElement("h2",null,"Game Over"),n.a.createElement("p",null,l),n.a.createElement("p",null,"classic"===p||"cooperation"===p?"Your final score: "+(o>0?o-1:0):"battleroyale"===p&&u?`${u}'s winning score: ${o}`:"Final Score: "+o),"battleroyale"===p&&g&&n.a.createElement("div",{className:"final-player-standings"},n.a.createElement("h3",null,"Final Standings:"),n.a.createElement("ul",null,g.sort((e,t)=>(t.score||0)-(e.score||0)).map(e=>n.a.createElement("li",{key:e.id||e.name,className:e.isActive?"":"eliminated-player"},e.name,": ",e.score||0," points ",e.isActive?"":"(Eliminated)")))),!f&&("classic"===p||"cooperation"===p||"battleroyale"===p&&o>0)&&n.a.createElement("form",{onSubmit:e=>{if(e.preventDefault(),!b.trim())return void w("Please enter your name");let t=0;if("classic"===p||"cooperation"===p?t=o>0?o-1:0:"battleroyale"===p&&(t=o),t<=0)w("Only scores greater than 0 can be submitted.");else if("unknown"!==y)try{console.log(`Submitting score: ${b}, ${t}, ${y}, History ID: ${C}`);(function(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!a||"string"!==typeof a)return console.error("Invalid category provided to submitScore:",a),null;const n="sortly_leaderboard_"+a.toLowerCase(),o=ee(a),l={id:Date.now(),playerName:e,score:t,date:(new Date).toISOString(),gameHistoryId:r};o.push(l),o.sort((e,t)=>t.score-e.score);const i=o.slice(0,100);try{return localStorage.setItem(n,JSON.stringify(i)),console.log("Score submitted to "+n,l),l}catch(E){return console.error(`Error saving leaderboard to localStorage for ${a}:`,E),null}})(b,t,y,C)?(h(!0),w("")):w("Failed to submit score (API error). Please try again.")}catch(a){console.error("Error during score submission:",a),w("Failed to submit score. Please try again.")}else w("Cannot submit score for unknown category.")},className:"score-submission"},n.a.createElement("div",{className:"input-group"},n.a.createElement("label",{htmlFor:"playerName"},"Enter your name for Leaderboard:"),n.a.createElement("input",{type:"text",id:"playerName",value:b,onChange:e=>v(e.target.value),placeholder:"Your name",maxLength:20,disabled:!a})),!a&&n.a.createElement("p",{className:"info-text"},"Log in to save game details and submit scores!"),E&&n.a.createElement("p",{className:"error"},E),n.a.createElement("button",{type:"submit",className:"button button-primary",disabled:!b.trim()||!j.current},"Submit Score")),f&&n.a.createElement("div",{className:"submission-success"},n.a.createElement("p",null,"Score submitted successfully!")),"classic"===p&&s&&c&&n.a.createElement("div",{className:"user-order"},n.a.createElement("h3",null,"Your final attempt (","gini"===y?"Gini":z(y),"):"),n.a.createElement("div",{className:"country-list"},s.map(e=>n.a.createElement(B,{key:e.id,country:e,isClickable:!1,highlight:e.id===c.id?"incorrect":"",mode:y,statisticValue:e[y],isFlippable:!0})))),"classic"===p&&d&&c&&n.a.createElement("div",{className:"correct-order-display"},n.a.createElement("h3",null,"Correctly sorted before mistake:"),n.a.createElement("div",{className:"country-list"},d.map(e=>n.a.createElement(B,{key:e.id,country:e,isClickable:!1,highlight:"correct",mode:y,statisticValue:e[y],isFlippable:!0})),n.a.createElement("p",{style:{textAlign:"center",width:"100%",margin:"10px 0"}},"...then you incorrectly placed:"),n.a.createElement("div",{className:"country-list",style:{justifyContent:"center"}},n.a.createElement(B,{key:c.id,country:c,isClickable:!1,highlight:"incorrect-standalone",mode:y,statisticValue:c[y],isFlippable:!0})))),n.a.createElement("div",{className:"navigation-buttons"},n.a.createElement("button",{onClick:()=>t("unknown"===y||"unknown"===p?"/":"classic"===p?`/game/${y}/classic`:"cooperation"===p?`/game/${y}/cooperation`:"battleroyale"===p?`/game/${y}/battleroyale`:"/"),className:"button button-secondary"},"Play Again"),n.a.createElement("button",{onClick:()=>t("/"),className:"button button-secondary"},"Go Home"),n.a.createElement("button",{onClick:()=>t("/leaderboard"),className:"button button-secondary"},"Leaderboard")))};const oe=e=>{try{let t=null;if(e&&"function"===typeof e.toDate)t=e.toDate();else if("string"===typeof e){if(t=new Date(e),isNaN(t.getTime()))return console.warn("formatDate received an invalid date string:",e),"Invalid Date"}else e instanceof Date&&(t=e);return t?t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):(console.warn("formatDate received an invalid input:",e),"Unknown Date")}catch(t){return console.error("Error formatting date:",e,t),"Date Error"}};a(61);const le=["population","area","gini"];var ie=function(){const[e,t]=Object(r.useState)({}),[a,o]=Object(r.useState)(!0),l=Object(m.q)();Object(r.useEffect)(()=>{(async()=>{o(!0);const e={};try{for(const t of le){const a=te(t,5),r=await Promise.all(a.map(async e=>{if(!e.gameHistoryId)return{...e,details:null};try{const t=await re.getGameDetails(e.gameHistoryId);return{...e,details:t||null}}catch(t){return console.error(`Failed to fetch details for game ${e.gameHistoryId}:`,t),{...e,details:null}}}));e[t]=r}console.log("Enriched Leaderboards:",e),t(e)}catch(a){console.error("Error loading leaderboards:",a)}finally{o(!1)}})()},[]);const i=(e,t)=>{const a="Classic "+z("gini"===e?"Gini Index":e);return n.a.createElement("div",{className:"leaderboard-section"},n.a.createElement("h3",null,a),t&&t.length>0?n.a.createElement("div",{className:"leaderboard-table"},n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Rank"),n.a.createElement("th",null,"Player"),n.a.createElement("th",null,"Score"),n.a.createElement("th",null,"Date"),n.a.createElement("th",null,"Game Overview"))),n.a.createElement("tbody",null,t.map((e,t)=>{var a;return n.a.createElement("tr",{key:e.id||t,onClick:()=>{var t;(t=e.gameHistoryId)?(console.log("Navigating to game review for ID:",t),l("/game-review/"+t)):(console.log("No game history ID associated with this leaderboard entry."),alert("Detailed game view not available for this entry (likely older data or not logged in when played)."))},className:e.gameHistoryId?"clickable-row":"",title:e.gameHistoryId?"Click to see game details":"Game details not available"},n.a.createElement("td",null,t+1),n.a.createElement("td",null,e.playerName),n.a.createElement("td",null,e.score),n.a.createElement("td",null,oe(e.date)),n.a.createElement("td",{className:"leaderboard-flags"},e.details&&"classic"===e.details.mode?n.a.createElement(n.a.Fragment,null,null===(a=e.details.correctlySortedList)||void 0===a?void 0:a.map(e=>n.a.createElement("img",{key:"flag-correct-"+(e.id||e.name),src:e.flagUrl,alt:e.name,title:e.name,className:"flag-image"})),e.details.incorrectCountry&&n.a.createElement("img",{key:"flag-incorrect-"+(e.details.incorrectCountry.id||e.details.incorrectCountry.name),src:e.details.incorrectCountry.flagUrl,alt:e.details.incorrectCountry.name+" (Incorrect)",title:e.details.incorrectCountry.name+" (Incorrect)",className:"flag-image incorrect-flag"}),n.a.createElement("span",{role:"img","aria-label":"View game details",className:"click-indicator",title:"Click for details"},"\ud83d\udd0d")):e.gameHistoryId?n.a.createElement("span",{role:"img","aria-label":"View game details",className:"click-indicator",title:"Click for details"},"\ud83d\udd0d"):n.a.createElement("span",null,"-")))})))):n.a.createElement("p",null,"No entries yet for this category."))};return n.a.createElement("div",{className:"leaderboard-page"},n.a.createElement(A,{title:"Global Leaderboards",description:"Check the top scores for Sortly. See who knows their geography best in population, area, and Gini index categories."}),n.a.createElement("h2",null,"Classic Leaderboards"),a?n.a.createElement("p",null,"Loading leaderboards..."):le.map(t=>i(t,e[t])),n.a.createElement("button",{onClick:()=>l("/"),className:"button button-secondary",style:{marginTop:"20px"}},"Go Home"))};const ce={population:{sorting:{bronze:{id:"population_sorting_bronze",title:"Population Bronze Sorter",description:"Correctly sort 3 countries by population",icon:"\ud83e\udd49",requirement:3},silver:{id:"population_sorting_silver",title:"Population Silver Sorter",description:"Correctly sort 7 countries by population",icon:"\ud83e\udd48",requirement:7},gold:{id:"population_sorting_gold",title:"Population Gold Sorter",description:"Correctly sort 12 countries by population",icon:"\ud83e\udd47",requirement:12},platinum:{id:"population_sorting_platinum",title:"Population Platinum Sorter",description:"Correctly sort 20 countries by population",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"population_games",title:"Population Game Master",description:"Complete 50 population sorting games",icon:"\ud83c\udfae",requirement:50}},area:{sorting:{bronze:{id:"area_sorting_bronze",title:"Area Bronze Sorter",description:"Correctly sort 3 countries by area",icon:"\ud83e\udd49",requirement:3},silver:{id:"area_sorting_silver",title:"Area Silver Sorter",description:"Correctly sort 7 countries by area",icon:"\ud83e\udd48",requirement:7},gold:{id:"area_sorting_gold",title:"Area Gold Sorter",description:"Correctly sort 12 countries by area",icon:"\ud83e\udd47",requirement:12},platinum:{id:"area_sorting_platinum",title:"Area Platinum Sorter",description:"Correctly sort 20 countries by area",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"area_games",title:"Area Game Master",description:"Complete 50 area sorting games",icon:"\ud83c\udfae",requirement:50}},gini:{sorting:{bronze:{id:"gini_sorting_bronze",title:"Gini Bronze Sorter",description:"Correctly sort 3 countries by Gini index",icon:"\ud83e\udd49",requirement:3},silver:{id:"gini_sorting_silver",title:"Gini Silver Sorter",description:"Correctly sort 7 countries by Gini index",icon:"\ud83e\udd48",requirement:7},gold:{id:"gini_sorting_gold",title:"Gini Gold Sorter",description:"Correctly sort 12 countries by Gini index",icon:"\ud83e\udd47",requirement:12},platinum:{id:"gini_sorting_platinum",title:"Gini Platinum Sorter",description:"Correctly sort 20 countries by Gini index",icon:"\ud83d\udc51",requirement:20}},gameCount:{id:"gini_games",title:"Gini Game Master",description:"Complete 50 Gini sorting games",icon:"\ud83c\udfae",requirement:50}}},se={async getUserAchievements(e){try{const t=await Object(f.d)(Object(f.c)(C,"achievements",e));return t.exists()?t.data():null}catch(t){throw console.error("Error getting user achievements:",t),t}},async updateUserAchievements(e,t){try{await Object(f.k)(Object(f.c)(C,"achievements",e),{...t,updatedAt:Object(f.j)()},{merge:!0})}catch(a){throw console.error("Error updating user achievements:",a),a}},async checkAndUpdateAchievements(e,t,a){try{var r,n;const o=await this.getUserAchievements(e)||{},l=ce[t];let i=!1;Object.values(l.sorting).forEach(e=>{!o[e.id]&&a>=e.requirement&&(o[e.id]={unlocked:!0,unlockedAt:Object(f.j)()},i=!0)});const c=l.gameCount,s=((null===(r=o[c.id])||void 0===r?void 0:r.count)||0)+1;return s>=c.requirement&&!(null===(n=o[c.id])||void 0===n?void 0:n.unlocked)?(o[c.id]={unlocked:!0,unlockedAt:Object(f.j)(),count:s},i=!0):(o[c.id]={...o[c.id],count:s},i=!0),i&&await this.updateUserAchievements(e,o),o}catch(o){throw console.error("Error checking achievements:",o),o}},getAchievementDefinitions:()=>ce};a(62);var me=e=>{let{avatarOptions:t,selectedAvatar:a,onSelect:r,onClose:o}=e;return n.a.createElement("div",{className:"avatar-selector"},n.a.createElement("div",{className:"avatar-grid"},t.map(e=>n.a.createElement("div",{key:e.id,className:"avatar-option "+(a===e.url?"selected":""),onClick:()=>r(e.url)},n.a.createElement("img",{src:e.url,alt:e.name}),n.a.createElement("span",null,e.name)))))};a(63);var de=e=>{let{profile:t,currentUser:a,avatarOptions:o,onSubmit:l}=e;const[i,c]=Object(r.useState)({nickname:(null===t||void 0===t?void 0:t.nickname)||"",country:(null===t||void 0===t?void 0:t.country)||"",avatarUrl:(null===t||void 0===t?void 0:t.avatarUrl)||o[0].url}),[s,m]=Object(r.useState)(!1),[d,u]=Object(r.useState)(!1),g=e=>{const{name:t,value:a}=e.target;c(e=>({...e,[t]:a})),u(!0)};return n.a.createElement("div",{className:"profile-header"},n.a.createElement("div",{className:"avatar-container"},n.a.createElement("img",{src:i.avatarUrl,alt:"Profile",className:"profile-avatar",onClick:()=>m(!0)}),s&&n.a.createElement(me,{avatarOptions:o,selectedAvatar:i.avatarUrl,onSelect:e=>{c(t=>({...t,avatarUrl:e})),m(!1),u(!0)},onClose:()=>m(!1)})),n.a.createElement("div",{className:"profile-info"},n.a.createElement("form",{onSubmit:async e=>{e.preventDefault();try{await l(i),u(!1)}catch(t){console.error("Error saving profile:",t)}},className:"profile-form"},n.a.createElement("div",{className:"form-group"},n.a.createElement("input",{type:"text",name:"nickname",value:i.nickname,onChange:g,placeholder:"Set your nickname",className:"inline-input"})),n.a.createElement("div",{className:"form-group"},n.a.createElement("input",{type:"text",name:"country",value:i.country,onChange:g,placeholder:"Set your country",className:"inline-input"})),n.a.createElement("div",{className:"email-display"},a.email),d&&n.a.createElement("button",{type:"submit",className:"save-button"},"Save Changes"))))};a(64);var ue=e=>{let{achievement:t,isUnlocked:a,unlockDate:r}=e;return n.a.createElement("div",{className:"achievement-card "+(a?"unlocked":"locked")},n.a.createElement("div",{className:"achievement-content"},n.a.createElement("div",{className:"achievement-icon"},t.icon),n.a.createElement("div",{className:"achievement-info"},n.a.createElement("h3",null,t.title),n.a.createElement("p",null,t.description),a&&r&&n.a.createElement("div",{className:"achievement-date"},"Unlocked: ",oe(r)))),n.a.createElement("div",{className:"achievement-status"},a?"\u2713":"\ud83d\udd12"))};a(65);var ge=e=>{let{achievementDefinitions:t,achievements:a}=e;const r=(e=>{const t=[];return Object.entries(e).forEach(e=>{let[a,r]=e;Object.entries(r.sorting).forEach(e=>{let[r,n]=e;t.push({...n,category:a,type:"sorting"})}),r.gameCount&&t.push({...r.gameCount,category:a,type:"gameCount"})}),t})(t);return n.a.createElement("div",{className:"achievements-section"},n.a.createElement("h2",null,"Achievements"),n.a.createElement("div",{className:"achievements-grid"},r.map(e=>{var t,r,o;return n.a.createElement(ue,{key:e.id,achievement:e,isUnlocked:null!==(t=null===a||void 0===a||null===(r=a[e.id])||void 0===r?void 0:r.unlocked)&&void 0!==t&&t,unlockDate:null===a||void 0===a||null===(o=a[e.id])||void 0===o?void 0:o.unlockedAt})})))};a(66);var pe=e=>{var t,a;let{game:r,index:o}=e;return n.a.createElement("div",{className:"game-history-item"},n.a.createElement("div",{className:"game-rank"},"#",o+1),n.a.createElement("div",{className:"game-score"},"Score: ",r.score),n.a.createElement("div",{className:"game-mode"},r.category.charAt(0).toUpperCase()+r.category.slice(1)," Mode"),n.a.createElement("div",{className:"game-date"},(null===(t=r.timestamp)||void 0===t?void 0:t.toDate)?oe(r.timestamp):"Date unavailable"),n.a.createElement("div",{className:"game-countries"},null===(a=r.countries)||void 0===a?void 0:a.map((e,t)=>n.a.createElement("div",{key:t,className:"country-item"},n.a.createElement("img",{src:e.flagUrl,alt:e.name,className:"country-flag"}),n.a.createElement("span",null,e.name)))))};a(67);var ye=e=>{let{gameHistory:t}=e;const a=Object(r.useMemo)(()=>{if(!t||0===Object.keys(t).length)return[];return Object.entries(t).flatMap(e=>{let[t,a]=e;return a.map(e=>({...e,category:t}))}).filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)).sort((e,t)=>t.score-e.score).slice(0,5)},[t]);return t?0===Object.keys(t).length?n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("p",null,"No games played yet. Start playing to see your best games here!")):n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("div",{className:"game-history-list"},a.map((e,t)=>n.a.createElement(pe,{key:e.id,game:e,index:t})))):n.a.createElement("div",{className:"game-history-section"},n.a.createElement("h2",null,"Best 5 Games"),n.a.createElement("p",null,"Loading game history..."))};a(68);var be=()=>{const{currentUser:e}=N(),t=Object(m.q)(),[a,o]=Object(r.useState)(null),[l,i]=Object(r.useState)(null),[c,s]=Object(r.useState)(null),[d,u]=Object(r.useState)(!0),[g,p]=Object(r.useState)(""),[y,b]=Object(r.useState)(!1),[v,f]=Object(r.useState)(!1),[h,E]=Object(r.useState)({nickname:"",country:"",avatarUrl:""}),w=k.getAvatarOptions(),C=se.getAchievementDefinitions(),O=null===e||void 0===e?void 0:e.uid,j=Object(r.useCallback)(async()=>{if(O)try{const[e,t,a]=await Promise.all([G.getUserProfile(O),se.getUserAchievements(O),re.getAllTopGames(O)]);e&&(o(e),E({nickname:e.nickname||"",country:e.country||"",avatarUrl:e.avatarUrl||w[0].url})),i(t),s(a)}catch(g){p("Failed to load profile: "+g.message)}finally{u(!1)}},[O,w]);Object(r.useEffect)(()=>{e&&j()},[e,j]);return e?d?n.a.createElement("div",{className:"profile-page"},"Loading..."):n.a.createElement("div",{className:"profile-page"},n.a.createElement("div",{className:"profile-content"},n.a.createElement(de,{profile:a,currentUser:e,editing:y,formData:h,avatarOptions:w,showAvatarSelector:v,onEdit:()=>b(!0),onAvatarSelect:e=>{E(t=>({...t,avatarUrl:e})),f(!1)},onAvatarSelectorToggle:()=>f(!v),onSubmit:async t=>{t.preventDefault();try{p(""),await G.updateUserProfile(e.uid,h),o(e=>({...e,...h})),b(!1)}catch(g){p("Failed to update profile: "+g.message)}},onChange:e=>{const{name:t,value:a}=e.target;E(e=>({...e,[t]:a}))},onCancel:()=>b(!1)}),g&&n.a.createElement("div",{className:"error-message"},g),n.a.createElement(ge,{achievementDefinitions:C,achievements:l}),n.a.createElement(ye,{gameHistory:c}))):(t("/"),null)};const ve=new class{constructor(){this.lobbiesRef=Object(h.e)(O,"lobbies")}async createLobby(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cooperation";const r=Object(h.e)(O,"lobbies/"+e);return await Object(h.g)(r,{players:[t],status:"waiting",gameMode:a,createdAt:Date.now(),lastUpdated:Date.now()}),e}async joinLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),r=(await Object(h.a)(a)).val();if(!r)throw new Error("Lobby not found");{const n=r.players||[];if(n.some(e=>e.id===t.id))return void console.warn(`Player ${t.id} already in lobby ${e}.`);await Object(h.h)(a,{players:[...n,t],lastUpdated:Date.now()})}}async leaveLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),r=(await Object(h.a)(a)).val();if(r){const n=(r.players||[]).filter(e=>e.id!==t);if(0===n.length)console.log(`Last player left lobby ${e}. Deleting lobby.`),await Object(h.f)(a);else{let e={players:n,lastUpdated:Date.now()};await Object(h.h)(a,e)}}else console.warn("Attempted to leave non-existent or already deleted lobby: "+e)}subscribeToLobby(e,t){const a=Object(h.e)(O,"lobbies/"+e),r=Object(h.d)(a,e=>{const a=e.val();t(a)},a=>{console.error(`Error subscribing to lobby ${e}:`,a),t(null)});return()=>Object(h.c)(a,"value",r)}async startGame(e){const t=Object(h.e)(O,"lobbies/"+e);await Object(h.h)(t,{status:"playing",startedAt:Date.now(),lastUpdated:Date.now()})}async endGame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Object(h.e)(O,"lobbies/"+e);await Object(h.h)(a,{status:"completed",result:t,endedAt:Date.now(),lastUpdated:Date.now()})}async cleanupLobby(e){console.log("Cleaning up lobby: "+e);const t=Object(h.e)(O,"lobbies/"+e);await Object(h.f)(t)}};a(69);const fe={cooperation:{minPlayers:2,maxPlayers:4,service:V,name:"Cooperation Mode"},battleRoyale:{minPlayers:2,maxPlayers:8,service:J,name:"Battle Royale Mode"}};var he=function(e){let{gameMode:t}=e;const{currentUser:a}=N(),{category:o}=Object(m.s)(),[l,c]=Object(r.useState)(""),[s,d]=Object(r.useState)([]),[u,g]=Object(r.useState)(!1),[p,y]=Object(r.useState)(""),[b,v]=Object(r.useState)(""),f=Object(m.q)(),[h]=Object(i.c)(),E=Object(r.useRef)(""),w=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(!t||!a||!o)return void(o||y("Game category not specified in URL."));let e=null,r=!0;return(async()=>{try{let s="";try{const e=await G.getUserProfile(a.uid);s=(null===e||void 0===e?void 0:e.nickname)||""}catch(n){console.error("Error fetching user profile:",n)}const m=h.get("lobby");let u="",p={id:a.uid,name:s||(m?"Player "+Math.floor(100*Math.random()):"Player 1"),email:a.email};if(w.current=p,m){u=m,E.current=u,r&&(c(u),g(!1));try{await ve.joinLobby(u,p)}catch(l){return console.error("Error joining lobby:",l),void(r&&y(l.message||"Failed to join lobby"))}}else{u=Math.random().toString(36).substring(2,8).toUpperCase(),E.current=u,r&&(c(u),g(!0));try{await ve.createLobby(u,p,t,o)}catch(i){return console.error("Error creating lobby:",i),void(r&&y(i.message||"Failed to create lobby"))}}e=ve.subscribeToLobby(u,e=>{if(r)if(e){var n;d(e.players||[]),g(e.players&&(null===(n=e.players[0])||void 0===n?void 0:n.id)===a.uid);const r=e.category;if(r&&r!==o&&console.warn(`Lobby category (${r}) doesn't match URL category (${o})`),"playing"===e.status)if(t&&o){const e=`/game/${o}/${t}`;try{console.log(`Navigating to ${e} with mode ${t} and category ${o}`),f(e,{state:{lobbyId:u}})}catch(l){console.error("Navigation error:",l)}}else console.error("Cannot navigate, gameMode prop or category param is missing."),y("Error determining game mode/category for navigation.")}else y("Lobby not found or has been closed")})}catch(p){console.error("Error initializing lobby:",p),r&&y("Failed to initialize lobby")}})(),()=>{r=!1,e&&e(),E.current&&w.current&&ve.leaveLobby(E.current,w.current.id)}},[t,h,a,f,o]);const C=async()=>{if(!t||!E.current||!o)return;const e=`${window.location.origin}/#/game/${o}/${t}?lobby=${encodeURIComponent(E.current)}`;try{await navigator.clipboard.writeText(e),v("Copied!"),setTimeout(()=>v(""),2e3)}catch(a){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),v("Copied!"),setTimeout(()=>v(""),2e3)}catch(r){v("Failed to copy"),console.error("Fallback copy failed: ",r)}document.body.removeChild(t)}};if(!t)return n.a.createElement("div",{className:"game-lobby"},"Error: Game mode not provided.");if(!o)return n.a.createElement("div",{className:"game-lobby"},"Error: Game category not specified in URL. ",p&&n.a.createElement("p",{className:"error-message"},p));if(!a)return n.a.createElement("div",{className:"game-lobby"},"Loading user...");const O=fe[t];return n.a.createElement("div",{className:"game-lobby"},n.a.createElement("div",{className:"lobby-header"},n.a.createElement("h2",null,(null===O||void 0===O?void 0:O.name)||"Game Lobby"," - ",o.toUpperCase()),l&&n.a.createElement("p",{className:"lobby-id-display"},"Lobby ID: ",n.a.createElement("strong",null,l))),p&&n.a.createElement("p",{className:"error-message"},p),n.a.createElement("div",{className:"player-list-container"},n.a.createElement("h3",null,"Players (",s.length," / ",(null===O||void 0===O?void 0:O.maxPlayers)||"N/A","):"),n.a.createElement("ul",{className:"player-list"},s.map((e,t)=>n.a.createElement("li",{key:e.id,className:"player-item"},n.a.createElement("span",{className:"player-name"},e.name||"Player "+(t+1)),e.id===a.uid&&n.a.createElement("span",{className:"player-tag you-tag"}," (You)"),0===t&&n.a.createElement("span",{className:"player-tag host-tag"}," (Host)"))))),l&&n.a.createElement("div",{className:"lobby-controls"},u?n.a.createElement(n.a.Fragment,null,n.a.createElement("button",{className:"button button-secondary",onClick:C,disabled:"Copied!"===b||"Failed to copy"===b},b||"Copy Invite Link"),n.a.createElement("button",{className:"button button-primary",onClick:async()=>{if(!u||!t||!E.current||!o)return;const e=fe[t];if(e)if(s.length<e.minPlayers)y(`Waiting for more players. Need at least ${e.minPlayers}.`);else if(s.length>e.maxPlayers)y(`Too many players. Maximum is ${e.maxPlayers}.`);else try{y(""),await e.service.initializeGameState(E.current,s,o),await ve.startGame(E.current)}catch(p){console.error("Error starting game:",p),y(p.message||"Failed to start game")}else y("Invalid game mode configuration.")},disabled:s.length<((null===O||void 0===O?void 0:O.minPlayers)||2)},"Start Game")):n.a.createElement("button",{className:"button button-secondary",onClick:C,disabled:"Copied!"===b||"Failed to copy"===b},b||"Copy Invite Link")))};const Ee={async addScore(e,t,a,r){try{return(await Object(f.a)(Object(f.b)(C,"scores"),{userId:e,username:t,score:a,gameMode:r,timestamp:Object(f.j)()})).id}catch(n){throw console.error("Error adding score:",n),n}},async getGlobalLeaderboard(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;try{const t=Object(f.i)(Object(f.b)(C,"scores"),Object(f.h)("score","desc"),e(e));return(await Object(f.e)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){throw console.error("Error getting leaderboard:",t),t}},async getUserBestScores(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{const a=Object(f.i)(Object(f.b)(C,"scores"),Object(f.m)("userId","==",e),Object(f.h)("score","desc"),t(t));return(await Object(f.e)(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(a){throw console.error("Error getting user scores:",a),a}}};function we(){const{currentUser:e,login:t,signup:a,logout:o}=N(),[l,i]=Object(r.useState)(""),[c,s]=Object(r.useState)(""),[m,d]=Object(r.useState)(""),[u,g]=Object(r.useState)(!1),[p,y]=Object(r.useState)(null);return n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement("h2",null,"Firebase Test"),e?n.a.createElement("div",null,n.a.createElement("p",null,"Logged in as: ",e.email),n.a.createElement("button",{onClick:async function(){try{d(""),g(!0),await o()}catch(m){d("Failed to log out: "+m.message)}g(!1)},disabled:u},"Log Out"),n.a.createElement("button",{onClick:async function(){if(e)try{await Ee.addScore(e.uid,e.email,100,"test"),y("Score added successfully!")}catch(m){y("Failed to add score: "+m.message)}},style:{marginLeft:"10px"}},"Add Test Score"),p&&n.a.createElement("p",null,p)):n.a.createElement("div",null,n.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{d(""),g(!0),await a(l,c)}catch(m){d("Failed to create an account: "+m.message)}g(!1)}},n.a.createElement("input",{type:"email",value:l,onChange:e=>i(e.target.value),placeholder:"Email",required:!0}),n.a.createElement("input",{type:"password",value:c,onChange:e=>s(e.target.value),placeholder:"Password",required:!0}),n.a.createElement("button",{type:"submit",disabled:u},"Sign Up")),n.a.createElement("form",{onSubmit:async function(e){e.preventDefault();try{d(""),g(!0),await t(l,c)}catch(m){d("Failed to log in: "+m.message)}g(!1)},style:{marginTop:"10px"}},n.a.createElement("button",{type:"submit",disabled:u},"Log In"))),m&&n.a.createElement("p",{style:{color:"red"}},m))}a(70);var Ce=function(){const{gameId:e}=Object(m.s)(),t=Object(m.q)(),[a,o]=Object(r.useState)(null),[l,c]=Object(r.useState)(!0),[s,d]=Object(r.useState)(null);if(Object(r.useEffect)(()=>{(async()=>{if(!e)return d("No game ID provided."),void c(!1);c(!0);try{console.log("Fetching game details for ID: "+e);const t=await re.getGameDetails(e);t?(console.log("Fetched game data:",t),t.correctlySortedList||(t.correctlySortedList=[]),t.incorrectCountry||(t.incorrectCountry=null),o(t)):d(`Game with ID ${e} not found.`)}catch(t){console.error("Error fetching game details:",t),d("Failed to load game details. Please try again later.")}finally{c(!1)}})()},[e]),l)return n.a.createElement("div",{className:"game-review-page loading"},"Loading game review...");if(s)return n.a.createElement("div",{className:"game-review-page error"},n.a.createElement("h2",null,"Error"),n.a.createElement("p",null,s),n.a.createElement("button",{onClick:()=>t("/leaderboard"),className:"button button-secondary"},"Back to Leaderboard"));if(!a)return n.a.createElement("div",{className:"game-review-page"},"Game data could not be loaded.");const u="classic"===a.mode&&a.correctlySortedList&&a.incorrectCountry,g="gini"===a.category?"Gini Index":z(a.category||"Unknown");return n.a.createElement("div",{className:"game-review-page"},n.a.createElement("h2",null,"Game Review - ",z(a.mode||"Game")," (",g,")"),n.a.createElement("p",null,"Score: ",a.score),n.a.createElement("p",null,"Played on: ",a.timestamp?oe(a.timestamp):"Date unknown"),u?n.a.createElement("div",{className:"review-section final-order-display"},n.a.createElement("h3",null,"Your Final Correct Sequence & Mistake:"),n.a.createElement("div",{className:"country-list combined-list"},a.correctlySortedList.map(e=>n.a.createElement(B,{key:"correct-"+(e.id||e.name),country:e,isClickable:!1,highlight:"correct",mode:a.category,statisticValue:e.value,isFlippable:!0})),a.incorrectCountry&&n.a.createElement(B,{key:"incorrect-"+(a.incorrectCountry.id||a.incorrectCountry.name),country:a.incorrectCountry,isClickable:!1,highlight:"incorrect",mode:a.category,statisticValue:a.incorrectCountry.value,isFlippable:!0}))):n.a.createElement("div",{className:"general-game-info review-section"},n.a.createElement("h3",null,"Game Summary"),a.userAttemptList&&a.userAttemptList.length>0?n.a.createElement("div",{className:"country-list"},a.userAttemptList.map(e=>n.a.createElement(B,{key:"attempt-"+(e.id||e.name),country:e,isClickable:!1,mode:a.category,statisticValue:e.value,isFlippable:!0}))):n.a.createElement("p",null,"Basic game data is available, but detailed review for this mode might not be fully implemented.")),n.a.createElement("div",{className:"navigation-buttons",style:{marginTop:"30px"}},n.a.createElement("button",{onClick:()=>t("/leaderboard"),className:"button button-secondary"},"Back to Leaderboard"),n.a.createElement(i.b,{to:"/",className:"button button-secondary"},"Go Home")))};a(71);var Oe=function(){var e,t;const a=Object(m.n)(),o=Object(m.o)("/game/:category/:mode"),l=Object(m.o)("/game/:category/:mode/*"),i=(null===o||void 0===o||null===(e=o.params)||void 0===e?void 0:e.category)||(null===l||void 0===l||null===(t=l.params)||void 0===t?void 0:t.category);let c="";return"population"===i?c="bg-population":"area"===i?c="bg-area":"gini"===i&&(c="bg-gini"),Object(r.useEffect)(()=>{g.a.initialize("G-9679TPXEBR")},[]),Object(r.useEffect)(()=>{g.a.send({hitType:"pageview",page:a.pathname})},[a.pathname]),n.a.createElement(d.b,null,n.a.createElement(S,null,n.a.createElement("div",{className:"App "+c},n.a.createElement(U,null),n.a.createElement("div",{className:"content"},n.a.createElement(m.d,null,n.a.createElement(m.b,{path:"/",element:n.a.createElement(M,null)}),n.a.createElement(m.b,{path:"/game/:category/cooperation",element:n.a.createElement(he,{gameMode:"cooperation"})}),n.a.createElement(m.b,{path:"/game/:category/battleroyale",element:n.a.createElement(he,{gameMode:"battleRoyale"})}),n.a.createElement(m.b,{path:"/game/:category/:mode",element:n.a.createElement(Q,null)}),n.a.createElement(m.b,{path:"/gameover",element:n.a.createElement(ne,null)}),n.a.createElement(m.b,{path:"/leaderboard",element:n.a.createElement(ie,null)}),n.a.createElement(m.b,{path:"/profile",element:n.a.createElement(be,null)}),n.a.createElement(m.b,{path:"/test",element:n.a.createElement(we,null)}),n.a.createElement(m.b,{path:"/game-review/:gameId",element:n.a.createElement(Ce,null)}))),n.a.createElement(I,null))))};a(72);l.a.createRoot(document.getElementById("root")).render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(i.a,null,n.a.createElement(c.a,{backend:s.a},n.a.createElement(Oe,null)))))}]),[[40,1,2]]]);
//# sourceMappingURL=main.a88e2e53.chunk.js.map